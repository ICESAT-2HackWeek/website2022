
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geospatial Transformations In-depth &#8212; ICESat-2 Hackweek 2022</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Interactive Visualizion with Open Altimetry &amp; Google Earth Engine" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html" />
    <link rel="prev" title="Geospatial Transforms" href="geospatial-intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LZVEY6377Z"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-LZVEY6377Z');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ICESat-2 Hackweek 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to ICESat-2 Hackweek!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Details
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../application.html">
   Application
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=schedule">
   Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=team">
   Team
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../mission.html">
   Hackweek Mission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../CoC.html">
   Event Code of Conduct
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preparation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../preliminary/index.html">
   Preliminary Work
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/swc.html">
     Software Carpentry Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/github.html">
     GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/jupyterhub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/git.html">
     Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthdata.html">
     Earthdata Login
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthengine.html">
     Google Earth Engine Sign-Up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/python.html">
     Python Installation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter.html">
     GitHub, Git, JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataProducts/DataProducts.html">
     ICESat-2 data products
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../data_access/data_access_1_intro.html">
     ICESat-2 Data Discovery, Visualization, and Access Resources
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_access/data_access_2_earthdata.html">
       Data Discovery and Access via
       <strong>
        earthdata
       </strong>
       library
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_access/data_access_3_icepyx.html">
       Accessing ICESat-2 Data Using icepyx
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="geospatial-intro.html">
     Geospatial Transforms
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Geospatial Transformations In-depth
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html">
     Interactive Visualizion with Open Altimetry &amp; Google Earth Engine
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../DataVisualization/Visualization_geemap_use_examples.html">
       OpenAltimery and GEE Use Examples
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../DataIntegration/dataintegration-1.html">
     Data integration with ICESat-2 - Part I
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../DataIntegration/dataintegration-2.html">
       Data integration with ICESat-2 - Part II
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../DataIntegration/data-applications.html">
       ICESat-2 Applications: GrIMP + SlideRule
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud-computing/cloud-computing-tutorial.html">
     Cloud Computing Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataVisualization/dataviz2d.html">
     <strong>
      Making nice maps for posters with Python
     </strong>
     🗺️+🐍
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../projects/index.html">
   Projects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roles.html">
     Project Roles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roadmap.html">
     Project Roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_initialization.html">
     Project Initialization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/list_of_projects.html">
     List of Projects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/glossary.html">
   Glossaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/IS2-resources.html">
   ICESat-2 Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_source_software.html">
   Open-source Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/questions.html">
   How to Get Help
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tutorials/geospatial/geospatial-advanced.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ICESAT-2HackWeek/website2022"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ICESAT-2HackWeek/website2022/issues/new?title=Issue%20on%20page%20%2Ftutorials/geospatial/geospatial-advanced.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ICESAT-2HackWeek/website2022/edit/main/book/tutorials/geospatial/geospatial-advanced.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ICESAT-2HackWeek/website2022/main?urlpath=lab/tree/book/tutorials/geospatial/geospatial-advanced.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-about-space">
   Questions about space
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-start-by-making-a-map">
   Let’s Start by Making a Map
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geographic-coordinate-systems">
   Geographic Coordinate Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes-on-projections">
   Notes on Projections
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-what-is-your-favorite-projection">
     <strong>
      Q: What is your favorite projection?
     </strong>
     🌎
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-what-projections-do-you-use-in-your-research">
     <strong>
      Q: What projections do you use in your research?
     </strong>
     🌏
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reference-systems-and-datums">
   Reference Systems and Datums
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-does-this-matter">
   Why Does This Matter?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-what-datum-is-right-for-me">
     <strong>
      Q: What datum is right for me?
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#terrestrial-reference-system">
   Terrestrial Reference System
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#permanent-tidal-systems">
   Permanent Tidal Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coordinate-reference-systems">
   Coordinate Reference Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pyproj-crs-tricks">
   pyproj CRS Tricks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geospatial-data">
   Geospatial Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-when-would-we-use-vector-over-raster">
     <strong>
      Q: When would we use vector over raster?
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-when-would-we-use-raster-over-vector">
     <strong>
      Q: When would we use raster over vector?
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-are-you-more-familiar-with-using-vector-or-raster-data">
     <strong>
      Q: Are you more familiar with using vector or raster data?
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-do-you-more-often-use-gis-software-or-command-line-tools">
     <strong>
      Q: Do you more often use GIS software or command-line tools?
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geospatial-data-abstraction-library">
   Geospatial Data Abstraction Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vector-data">
   Vector Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#raster-data">
   Raster Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#warping-raster-imagery">
   Warping Raster Imagery
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rasterio-transforms">
   Rasterio Transforms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-raster-data-with-rasterio">
   Saving Raster Data with Rasterio
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#climate-and-forecast-cf-metadata-conventions">
   Climate and Forecast (CF) Metadata Conventions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#converting-netcdf4-to-cloud-optimized-geotiff-cog">
   Converting netCDF4 to Cloud Optimized GeoTIFF (COG)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-concepts-comparing-datasets">
   Combining Concepts: Comparing Datasets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-how-could-we-improve-the-comparison">
     <strong>
      Q: How could we improve the comparison?
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Geospatial Transformations In-depth</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-about-space">
   Questions about space
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-start-by-making-a-map">
   Let’s Start by Making a Map
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geographic-coordinate-systems">
   Geographic Coordinate Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes-on-projections">
   Notes on Projections
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-what-is-your-favorite-projection">
     <strong>
      Q: What is your favorite projection?
     </strong>
     🌎
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-what-projections-do-you-use-in-your-research">
     <strong>
      Q: What projections do you use in your research?
     </strong>
     🌏
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reference-systems-and-datums">
   Reference Systems and Datums
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-does-this-matter">
   Why Does This Matter?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-what-datum-is-right-for-me">
     <strong>
      Q: What datum is right for me?
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#terrestrial-reference-system">
   Terrestrial Reference System
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#permanent-tidal-systems">
   Permanent Tidal Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coordinate-reference-systems">
   Coordinate Reference Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pyproj-crs-tricks">
   pyproj CRS Tricks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geospatial-data">
   Geospatial Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-when-would-we-use-vector-over-raster">
     <strong>
      Q: When would we use vector over raster?
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-when-would-we-use-raster-over-vector">
     <strong>
      Q: When would we use raster over vector?
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-are-you-more-familiar-with-using-vector-or-raster-data">
     <strong>
      Q: Are you more familiar with using vector or raster data?
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-do-you-more-often-use-gis-software-or-command-line-tools">
     <strong>
      Q: Do you more often use GIS software or command-line tools?
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geospatial-data-abstraction-library">
   Geospatial Data Abstraction Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vector-data">
   Vector Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#raster-data">
   Raster Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#warping-raster-imagery">
   Warping Raster Imagery
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rasterio-transforms">
   Rasterio Transforms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-raster-data-with-rasterio">
   Saving Raster Data with Rasterio
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#climate-and-forecast-cf-metadata-conventions">
   Climate and Forecast (CF) Metadata Conventions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#converting-netcdf4-to-cloud-optimized-geotiff-cog">
   Converting netCDF4 to Cloud Optimized GeoTIFF (COG)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-concepts-comparing-datasets">
   Combining Concepts: Comparing Datasets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-how-could-we-improve-the-comparison">
     <strong>
      Q: How could we improve the comparison?
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="geospatial-transformations-in-depth">
<h1>Geospatial Transformations In-depth<a class="headerlink" href="#geospatial-transformations-in-depth" title="Permalink to this headline">¶</a></h1>
<p>Instructors: <a class="reference external" href="mailto:tsutterl&#37;&#52;&#48;uw&#46;edu">Tyler Sutterley</a>, <a class="reference external" href="mailto:bessoh2&#37;&#52;&#48;uw&#46;edu">Hannah Besso</a> and <a class="reference external" href="mailto:scottyh&#37;&#52;&#48;uw&#46;edu">Scott Henderson</a></p>
<div class="section" id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Review fundamental concepts of coordinate reference systems (CRS)</p></li>
<li><p>Learn how to access coordinate reference metadata</p></li>
<li><p>Learn how to warp vector and raster data to different CRS</p></li>
</ul>
<p>In this advanced and comprehensive notebook, we will explore coordinate systems, map projections, geophysical concepts and available geospatial software tools.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We link to the documentation of these great libraries at the end of the notebook</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits</span> <span class="kn">import</span> <span class="n">mplot3d</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">osgeo.gdal</span><span class="o">,</span> <span class="nn">osgeo.osr</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">rasterio.features</span>
<span class="kn">import</span> <span class="nn">rasterio.warp</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="c1"># import routines for this notebook</span>
<span class="kn">import</span> <span class="nn">utilities</span>
<span class="kn">from</span> <span class="nn">ATL06_to_dataframe</span> <span class="kn">import</span> <span class="n">ATL06_to_dataframe</span>
<span class="c1"># turn off warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="questions-about-space">
<h2>Questions about space<a class="headerlink" href="#questions-about-space" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Where is something located?</p></li>
<li><p>What is its height?</p></li>
<li><p>Does it have an extent or is it a point?</p></li>
</ul>
<!--
Questions about time
--------------------
- When were the location, height and extent measured?
- Have the location, height or extent changed over time?
--></div>
<div class="section" id="let-s-start-by-making-a-map">
<h2>Let’s Start by Making a Map<a class="headerlink" href="#let-s-start-by-making-a-map" title="Permalink to this headline">¶</a></h2>
<p><strong>Q: Why would we use maps to display geographic data?</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.55</span><span class="p">))</span>
<span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="geographic-coordinate-systems">
<h2>Geographic Coordinate Systems<a class="headerlink" href="#geographic-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p>Locations on Earth are usually specified in a geographic coordinate system consisting of</p>
<ul class="simple">
<li><p><em>Longitude</em> specifies the angle east and west from the Prime Meridian (102 meters east of the Royal Observatory at Greenwich)</p></li>
<li><p><em>Latitude</em> specifies the angle north and south from the Equator</p></li>
</ul>
<p>The map above <em>projects</em> geographic data from the Earth’s 3-dimensional geometry on to a flat surface.  <a class="reference external" href="https://courses.washington.edu/gis250/lessons/projection/">The three common types of projections are <em>cylindric</em>, <em>conic</em> and <em>planar</em></a>.  Each type is a different way of flattening the Earth’s geometry into 2-dimensional space.</p>
<p>This map is in an <em>Equirectangular Projection</em> (Plate Carrée), where latitude and longitude are equally spaced.  Equirectangular is cylindrical projection, which has benefits as latitudes and longitudes form straight lines.  However, this projection distorts both <em>shape</em> and <em>distance</em>, particularly at higher latitudes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.375</span><span class="p">,</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="n">dlon</span><span class="p">,</span><span class="n">dlat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="o">+</span><span class="n">dlon</span><span class="p">,</span><span class="n">dlon</span><span class="p">)</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="o">+</span><span class="n">dlat</span><span class="p">,</span><span class="n">dlat</span><span class="p">)</span>
<span class="c1"># calculate and plot grid area</span>
<span class="n">gridlon</span><span class="p">,</span><span class="n">gridlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gridlat</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">),</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="p">),</span> 
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">),</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="c1"># add colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">]))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Grid Area&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">solids</span><span class="o">.</span><span class="n">set_rasterized</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="notes-on-projections">
<h2>Notes on Projections<a class="headerlink" href="#notes-on-projections" title="Permalink to this headline">¶</a></h2>
<p><em>There is no perfect projection for all purposes</em></p>
<p>Not all maps are good for ocean or land navigation</p>
<p>Not all projections are good for polar mapping</p>
<p>Every projection will distort either shape, area, distance or direction</p>
<ul class="simple">
<li><p><em>conformal</em> projections minimize distortion in shape</p></li>
<li><p><em>equal-area</em> projections minimize distortion in area</p></li>
<li><p><em>equidistant</em> projections minimize distortion in distance</p></li>
<li><p><em>true-direction</em> projections minimize distortion in direction</p></li>
</ul>
<p>While there are <a class="reference external" href="https://pubs.usgs.gov/gip/70047422/report.pdf">projections that are better suited for specific purposes</a>, <a class="reference external" href="https://pubs.usgs.gov/pp/1395/report.pdf">choosing a map projection</a> is a bit of an art 🦋</p>
<p><a class="reference external" href="https://xkcd.com/977/"><img alt="" src="https://imgs.xkcd.com/comics/map_projections.png" /></a></p>
<div class="section" id="q-what-is-your-favorite-projection">
<h3><strong>Q: What is your favorite projection?</strong> 🌎<a class="headerlink" href="#q-what-is-your-favorite-projection" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="q-what-projections-do-you-use-in-your-research">
<h3><strong>Q: What projections do you use in your research?</strong> 🌏<a class="headerlink" href="#q-what-projections-do-you-use-in-your-research" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="reference-systems-and-datums">
<h2>Reference Systems and Datums<a class="headerlink" href="#reference-systems-and-datums" title="Permalink to this headline">¶</a></h2>
<p>Coordinates are defined to be in <em>reference</em> to the origins of the coordinate system</p>
<ul class="simple">
<li><p>Horizontally, coordinates are in reference to the Equator and the Prime Meridian</p></li>
<li><p>Vertically, heights are in reference to a <a class="reference external" href="https://vdatum.noaa.gov/docs/datums.html"><em>datum</em></a></p></li>
</ul>
<p>Two common vertical datums are the reference <em>ellipsoid</em> and the reference <em>geoid</em>.</p>
<p>What are they and what is the difference?</p>
<ul class="simple">
<li><p>To ﬁrst approximation, the Earth is a sphere (🐄) with a radius of 6371 kilometers.</p></li>
<li><p>To a better approximation, the Earth is a slightly flattened ellipsoid with the polar axis 22 kilometers shorter than the equatorial axis.</p></li>
<li><p>To an even better approximation, the Earth’s shape can be described using a reference geoid, which undulates 10s of meters above and below the reference ellipsoid. The difference in height between the ellipsoid and the geoid are known as <em>geoid heights</em>.</p></li>
</ul>
<p>The geoid is an <em>equipotential surface</em>, perpendicular to the force of gravity at all points and with a constant geopotential. Reference ellipsoids and geoids are both created to largely coincide with mean sea level if the oceans were at rest.</p>
<p>An <em>ellipsoid can be considered a simplification of a geoid</em>.</p>
<p><img alt="Derived from the International Centre for Global Earth Models (ICGEM)" src="../../_images/EGM2008.png" /></p>
<p><a class="reference external" href="https://cdn.proj.org/">PROJ hosts grids for shifting both the horizontal and vertical datum</a>, such as gridded <a class="reference external" href="https://cdn.proj.org/us_nga_egm08_25.tif">EGM2008 geoid height values</a></p>
<p>Additional geoid height values can be calculated at the <a class="reference external" href="http://icgem.gfz-potsdam.de/home">International Centre for Global Earth Models (ICGEM)</a></p>
</div>
<div class="section" id="why-does-this-matter">
<h2>Why Does This Matter?<a class="headerlink" href="#why-does-this-matter" title="Permalink to this headline">¶</a></h2>
<p>ICESat-2 elevations are in reference to the WGS84 (G1150) ellipsoid.  ICESat-2 data products also include geoid heights from the <a class="reference external" href="https://www.usna.edu/Users/oceano/pguth/md_help/html/egm96.htm">EGM2008 geoid</a>.  Different ground-based, airborne or satellite-derived elevations may use a separate datum entirely.  <em>Elevations have to be in the same reference frame when comparing heights</em>.</p>
<p>Different datums have different purposes.  Heights above mean sea level are needed for ocean and sea ice heights, and are also commonly used for terrestrial mapping (e.g. as elevations of mountains).  Ellipsoidal heights are commonly used for estimating land ice height change.</p>
<div class="section" id="q-what-datum-is-right-for-me">
<h3><strong>Q: What datum is right for me?</strong><a class="headerlink" href="#q-what-datum-is-right-for-me" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If it is useful to be in reference to sea level: be in reference to the geoid</p></li>
<li><p>If that doesn’t matter: can be in reference to the ellipsoid</p></li>
<li><p>If comparing datasets: have everything be in the same datum</p></li>
</ul>
<p><img alt="Modified from: Tapley, B. D. &amp; M-C. Kim, Applications to Geodesy, Chapt. 10 in Satellite Altimetry and Earth Sciences, ed. by L-L. Fu &amp; A. Cazenave, Academic Press, pp. 371-406, 2001." src="../../_images/IS2_surfaces_and_datums.png" /></p>
</div>
</div>
<div class="section" id="terrestrial-reference-system">
<h2>Terrestrial Reference System<a class="headerlink" href="#terrestrial-reference-system" title="Permalink to this headline">¶</a></h2>
<p>Locations of satellites are determined in an Earth-centered cartesian coordinate system</p>
<ul class="simple">
<li><p><strong>X</strong>, <strong>Y</strong>, and <strong>Z</strong> measurements from the Earth’s center of mass</p></li>
</ul>
<p>Presently ICESat-2 is set in the <a class="reference external" href="https://itrf.ign.fr/ITRF_solutions/2014/ITRF2014.php">2014 realization of the International Terrestrial Reference Frame (ITRF)</a>.  Other satellite and airborne altimetry missions may be in a different ITRF.</p>
<p>As opposed to simple vertical offsets, changing the terrestrial reference system can involve both <a class="reference external" href="https://itrf.ign.fr/doc_ITRF/Transfo-ITRF2014_ITRFs.txt">translation and rotation of the reference system</a>.  This involves converting from a geographic coordinate system into a Cartesian coordinate system.</p>
<p>The <a class="reference external" href="https://nsidc.org/nsidc-highlights/2021/03/there-and-back-again-iceflow-data-tool">NSIDC IceFlow API</a> will standardize data from NASA altimetry missions to a single ITRF realization.</p>
<p>Let’s visualize what the Cartesian coordinate system looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_cartesian</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">a_axis</span><span class="o">=</span><span class="mf">6378137.0</span><span class="p">,</span><span class="n">flat</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">298.257223563</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts geodetic coordinates to Cartesian coordinates</span>

<span class="sd">    Inputs:</span>
<span class="sd">        lon: longitude (degrees east)</span>
<span class="sd">        lat: latitude (degrees north)</span>

<span class="sd">    Options:</span>
<span class="sd">        h: height above ellipsoid (or sphere)</span>
<span class="sd">        a_axis: semimajor axis of the ellipsoid (default: WGS84)</span>
<span class="sd">            * for spherical coordinates set to radius of the Earth</span>
<span class="sd">        flat: ellipsoidal flattening (default: WGS84)</span>
<span class="sd">            * for spherical coordinates set to 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># verify axes</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="c1"># fix coordinates to be 0:360</span>
    <span class="n">lon</span><span class="p">[</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">360.0</span>
    <span class="c1"># Linear eccentricity and first numerical eccentricity</span>
    <span class="n">lin_ecc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">2.0</span><span class="o">*</span><span class="n">flat</span> <span class="o">-</span> <span class="n">flat</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">a_axis</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ecc1</span> <span class="o">=</span> <span class="n">lin_ecc</span><span class="o">/</span><span class="n">a_axis</span>
    <span class="c1"># convert from geodetic latitude to geocentric latitude</span>
    <span class="n">dtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="c1"># geodetic latitude in radians</span>
    <span class="n">latitude_geodetic_rad</span> <span class="o">=</span> <span class="n">lat</span><span class="o">*</span><span class="n">dtr</span>
    <span class="c1"># prime vertical radius of curvature</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">a_axis</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ecc1</span><span class="o">**</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude_geodetic_rad</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="c1"># calculate X, Y and Z from geodetic latitude and longitude</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude_geodetic_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lon</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude_geodetic_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lon</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ecc1</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude_geodetic_rad</span><span class="p">)</span>
    <span class="c1"># return the cartesian coordinates</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">))</span>
<span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="n">dlon</span><span class="p">,</span><span class="n">dlat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="o">+</span><span class="n">dlon</span><span class="p">,</span><span class="n">dlon</span><span class="p">)</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="o">+</span><span class="n">dlat</span><span class="p">,</span><span class="n">dlat</span><span class="p">)</span>
<span class="c1"># calculate and plot grid area</span>
<span class="n">gridlon</span><span class="p">,</span><span class="n">gridlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="n">to_cartesian</span><span class="p">(</span><span class="n">gridlon</span><span class="p">,</span><span class="n">gridlat</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">gridlat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Yep, that looks like an ellipsoid</p>
</div>
<div class="section" id="permanent-tidal-systems">
<h2>Permanent Tidal Systems<a class="headerlink" href="#permanent-tidal-systems" title="Permalink to this headline">¶</a></h2>
<p>Tides on the Earth are caused by the gravitational forces of the Sun and Moon.</p>
<p><strong>Q: What do you think of when you think of tides?</strong></p>
<p>In addition to the ups and downs of tides, there is considerable part that does not vary in time, a <em>permanent tide</em> that is due to the Earth being in the presence of the Sun and Moon.  The <a class="reference external" href="https://www.ngs.noaa.gov/PUBS_LIB/EGM96_GEOID_PAPER/egm96_geoid_paper.html">Earth is lower in polar areas and higher in equatorial areas</a> than it would without those gravitational effects.  In effect, the Earth’s crust and geoid have more of an equatorial bulge.</p>
<p>All of the the tidal effects, the periodic and the permanent, are typically removed from a geoid model.  These geoid models are <em>tide-free</em>.</p>
<p>For most use cases in the real world, we want to include the permanent tide as part of the geoid because it reflects the Earth as it is, in the solar system with the sun 🌞 and the moon 🌜.</p>
<!--
The sun and the moon have both a direct and an indirect effect on the Earth's permanent tide.
- _Direct effect_: the actual bulge in the ocean and solid earth from the gravitational attraction
- _Indirect effect_: the elastic deformation in the Solid Earth induced by the redistribution of mass.

The direct and indirect effects of the permanent tide can be restored to _tide-free_ reference geoids.  Depending on the level of processing, geoid heights can be referred to be in one of [three different tidal systems](http://mitgcm.org/~mlosch/geoidcookbook/node9.html):
- _Mean Tide_: includes the deformation effects of the permanent tide 
- _Zero Tide_: only indirect effects of the permanent tide are restored
- _Tide-Free_: direct and indirect effects of the permanent tide are restored
-->
<p>Since Release-4, the EGM2008 geoid heights provided in ICESat-2 products have used a <em>tide-free</em> system.  There is a parameter included in the ICESat-2 products for converting back to a <em>mean tide</em> system, <a class="reference external" href="http://mitgcm.org/~mlosch/geoidcookbook/node9.html">which restores the permanent tide components</a> and coincides with with mean sea level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="n">dlon</span><span class="p">,</span><span class="n">dlat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="o">+</span><span class="n">dlon</span><span class="p">,</span><span class="n">dlon</span><span class="p">)</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="o">+</span><span class="n">dlat</span><span class="p">,</span><span class="n">dlat</span><span class="p">)</span>
<span class="c1"># calculate and plot permanent tide transformation</span>
<span class="n">gridlon</span><span class="p">,</span><span class="n">gridlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">90.0</span> <span class="o">-</span> <span class="n">gridlat</span><span class="p">)</span><span class="o">/</span><span class="mf">180.0</span>
<span class="c1"># unnormalized Legendre polynomial of degree 2</span>
<span class="n">P2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># love number of degree 2 (IERS standards)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="c1"># transformations for changing from tide-free to different permanent tides</span>
<span class="n">geoid_free2mean</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.198</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span><span class="o">*</span><span class="n">P2</span>
<span class="n">geoid_free2zero</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.198</span><span class="o">*</span><span class="n">k2</span><span class="o">*</span><span class="n">P2</span>
<span class="n">geoid_zero2mean</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.198</span><span class="o">*</span><span class="n">P2</span>

<span class="c1"># plot geoid conversion from free2mean (same as in ICESat-2 products)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.375</span><span class="p">,</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="n">geoid_free2mean</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="p">),</span> 
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">),</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="c1"># add colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">]))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Geoid Correction [cm]&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">solids</span><span class="o">.</span><span class="n">set_rasterized</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>

<span class="c1"># show zonal averages of permanent tide transforms</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="n">geoid_free2mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;mediumseagreen&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;free2mean&#39;</span><span class="p">)</span>
<span class="c1"># ax2.plot(100.0*geoid_free2zero[:,0], latitude, color=&#39;darkorchid&#39;, label=&#39;free2zero&#39;)</span>
<span class="c1"># ax2.plot(100.0*geoid_zero2mean[:,0], latitude, color=&#39;darkorange&#39;, label=&#39;zero2mean&#39;)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Geoid Correction [cm]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="c1"># add legend</span>
<span class="n">lgd</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lgd</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lgd</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="coordinate-reference-systems">
<h2>Coordinate Reference Systems<a class="headerlink" href="#coordinate-reference-systems" title="Permalink to this headline">¶</a></h2>
<p>Combined, projections and vertical datums can describe a Coordinate Reference System (CRS).</p>
<p>There are many different ways of <a class="reference external" href="https://spatialreference.org/">detailing a coordinate reference system (CRS)</a>.  Three common CRS formats are:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://www.ogc.org/standards/wkt-crs">Well-Known Text (WKT)</a>: can describe any coordinate reference system and is the standard for a lot of software</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span>
    <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;WGS_1984&quot;</span><span class="p">,</span>
        <span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span><span class="mi">6378137</span><span class="p">,</span><span class="mf">298.257223563</span><span class="p">,</span>
            <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;7030&quot;</span><span class="p">]],</span>
        <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;6326&quot;</span><span class="p">]],</span>
    <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;8901&quot;</span><span class="p">]],</span>
    <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.01745329251994328</span><span class="p">,</span>
        <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9122&quot;</span><span class="p">]],</span>
    <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;4326&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<ol class="simple">
<li><p><a class="reference external" href="https://proj.org/">PROJ string</a>: shorter with some less information but can also describe any coordinate reference system</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">WGS84</span> <span class="o">+</span><span class="n">datum</span><span class="o">=</span><span class="n">WGS84</span> <span class="o">+</span><span class="n">no_defs</span> 
</pre></div>
</div>
<ol class="simple">
<li><p><a class="reference external" href="https://epsg.io/">EPSG code</a>: simple and easy to remember</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EPSG</span><span class="p">:</span><span class="mi">4326</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crs4326</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
<span class="n">crs3031</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">3031</span><span class="p">)</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">crs4326</span><span class="p">,</span> <span class="n">crs3031</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can use these transformers with geopandas to make a polar stereographic plot.</p>
<p>The Coordinate Reference System of a <a class="reference external" href="http://geopandas.org/projections.html">geopandas GeoDataFrame can be transformed to another</a> using the <code class="docutils literal notranslate"><span class="pre">to_crs()</span></code> function.  The <code class="docutils literal notranslate"><span class="pre">to_crs()</span></code> function can import different forms including WKT strings, PROJ strings, EPSG codes and pyproj CRS objects.  The GeoDataFrame must have an original CRS before the conversion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3100000</span><span class="p">,</span><span class="mi">3100000</span><span class="p">,</span><span class="o">-</span><span class="mi">2600000</span><span class="p">,</span><span class="mi">2600000</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs3031</span><span class="p">)</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">crs3031</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ahhh Antarctica 🐧</p>
<p>Stereographic projections are common for mapping in polar regions.  A lot of legacy data products for both Greenland and Antarctica use polar stereographic projections. Some other polar products, such as NSIDC EASE/EASE-2 grids, are in <em>equal-area</em> projections.</p>
<p>Stereographic projections are <em>conformal</em>, preserving angles but not distances or areas.  <em>Equal-area</em> map projection cannot be conformal, nor can a conformal map projection be equal-area.</p>
<p><em>If CRS metadata on any products isn’t included within the data product, make sure it’s in the right projection and datum.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale_areas</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">298.257223563</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mf">70.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Area scaling factors for a polar stereographic projection including special</span>
<span class="sd">        exact pole case</span>

<span class="sd">    Inputs:</span>
<span class="sd">        lat: latitude (degrees north)</span>

<span class="sd">    Options:</span>
<span class="sd">        flat: ellipsoidal flattening</span>
<span class="sd">        ref: reference latitude (standard parallel)</span>

<span class="sd">    Returns:</span>
<span class="sd">        scale: area scaling factors at input latitudes</span>

<span class="sd">    References:</span>
<span class="sd">        Snyder, J P (1982) Map Projections used by the U.S. Geological Survey</span>
<span class="sd">            Forward formulas for the ellipsoid.  Geological Survey Bulletin</span>
<span class="sd">            1532, U.S. Government Printing Office.</span>
<span class="sd">        JPL Technical Memorandum 3349-85-101</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert latitude from degrees to positive radians</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="c1"># convert reference latitude from degrees to positive radians</span>
    <span class="n">theta_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="c1"># square of the eccentricity of the ellipsoid</span>
    <span class="c1"># ecc2 = (1-b**2/a**2) = 2.0*flat - flat^2</span>
    <span class="n">ecc2</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">flat</span> <span class="o">-</span> <span class="n">flat</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># eccentricity of the ellipsoid</span>
    <span class="n">ecc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ecc2</span><span class="p">)</span>
    <span class="c1"># calculate ratio at input latitudes</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ecc2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span> <span class="o">-</span> <span class="n">theta</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ecc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">/</span> \
        <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">ecc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="n">ecc</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="c1"># calculate ratio at reference latitude</span>
    <span class="n">mref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_ref</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ecc2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_ref</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">tref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span> <span class="o">-</span> <span class="n">theta_ref</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ecc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_ref</span><span class="p">))</span> <span class="o">/</span> \
        <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">ecc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_ref</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="n">ecc</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="c1"># distance scaling for general and polar case</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">mref</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">tref</span><span class="p">)</span>
    <span class="n">kp</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">mref</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="mf">1.0</span><span class="o">+</span><span class="n">ecc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">ecc</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">ecc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">ecc</span><span class="p">)))</span><span class="o">/</span><span class="n">tref</span>
    <span class="c1"># calculate area scaling factor</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">kp</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">scale</span>
</pre></div>
</div>
</div>
</div>
<p>pyproj transform objects can be used to change the Coordinate Reference System of arrays.</p>
<p>Here, we’ll use the transform to get the latitude and longitude coordinates of points in this projection (an <em>inverse</em> transformation), and get the polar stereographic coordinates for plotting a circle around the standard parallel (-71°) of this projection (a <em>forward</em> transformation).</p>
<p>The <em>standard parallel</em> of a stereographic projection is the latitude where there is no scale distortion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3100000</span><span class="p">,</span><span class="mi">3100000</span><span class="p">,</span><span class="o">-</span><span class="mi">2600000</span><span class="p">,</span><span class="mi">2600000</span><span class="p">)</span>
<span class="n">dx</span><span class="p">,</span><span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="c1"># create a grid of polar stereographic points</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span><span class="n">dy</span><span class="p">)</span>
<span class="n">gridx</span><span class="p">,</span><span class="n">gridy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="c1"># convert polar stereographic points to latitude/longitude (WGS84)</span>
<span class="n">gridlon</span><span class="p">,</span><span class="n">gridlat</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">gridx</span><span class="p">,</span> <span class="n">gridy</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="n">pyproj</span><span class="o">.</span><span class="n">enums</span><span class="o">.</span><span class="n">TransformDirection</span><span class="o">.</span><span class="n">INVERSE</span><span class="p">)</span>
<span class="c1"># calculate and plot grid area</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">crs3031</span><span class="o">.</span><span class="n">to_cf</span><span class="p">()</span>
<span class="n">flat</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">cf</span><span class="p">[</span><span class="s1">&#39;inverse_flattening&#39;</span><span class="p">]</span>
<span class="n">gridarea</span> <span class="o">=</span> <span class="n">scale_areas</span><span class="p">(</span><span class="n">gridlat</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">cf</span><span class="p">[</span><span class="s1">&#39;standard_parallel&#39;</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gridarea</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">),</span> 
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">),</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="c1"># add circle around standard parallel</span>
<span class="n">ref_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
<span class="n">ref_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">360</span><span class="p">))</span><span class="o">*</span><span class="n">cf</span><span class="p">[</span><span class="s1">&#39;standard_parallel&#39;</span><span class="p">]</span>
<span class="c1"># convert latitude/longitude (WGS84) points to polar stereographic</span>
<span class="n">ref_x</span><span class="p">,</span><span class="n">ref_y</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">,</span> <span class="n">ref_lat</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="n">pyproj</span><span class="o">.</span><span class="n">enums</span><span class="o">.</span><span class="n">TransformDirection</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
<span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Standard Parallel&#39;</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs3031</span><span class="p">)</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">crs3031</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="c1"># add colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">]))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Grid Area&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">solids</span><span class="o">.</span><span class="n">set_rasterized</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># add legend</span>
<span class="n">lgd</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lgd</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lgd</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lgd</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()):</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Why is there a black line to the pole?  Because this coastline was reprojected from a Equirectangular projection.  That’s the bottom of the Equirectangular map.</p>
</div>
<div class="section" id="pyproj-crs-tricks">
<h2>pyproj CRS Tricks<a class="headerlink" href="#pyproj-crs-tricks" title="Permalink to this headline">¶</a></h2>
<p>pyproj CRS objects can:</p>
<ul class="simple">
<li><p>Be converted to different methods of describing the CRS, such a to a PROJ string or WKT</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">proj3031</span> <span class="o">=</span> <span class="n">crs3031</span><span class="o">.</span><span class="n">to_proj4</span><span class="p">()</span>
<span class="n">wkt3031</span> <span class="o">=</span> <span class="n">crs3031</span><span class="o">.</span><span class="n">to_wkt</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">proj3031</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span><span class="p">(</span><span class="n">crs3031</span><span class="o">.</span><span class="n">is_exact_same</span><span class="p">(</span><span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_wkt</span><span class="p">(</span><span class="n">wkt3031</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Provide information about each coordinate reference system, such as the name, area of use and axes units.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">EPSG</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3031</span><span class="p">,</span><span class="mi">3413</span><span class="p">,</span><span class="mi">5936</span><span class="p">,</span><span class="mi">6931</span><span class="p">,</span><span class="mi">6932</span><span class="p">):</span>
  <span class="n">crs</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">EPSG</span><span class="p">)</span>
  <span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">crs</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">EPSG</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Region: </span><span class="si">{</span><span class="n">crs</span><span class="o">.</span><span class="n">area_of_use</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Scope: </span><span class="si">{</span><span class="n">crs</span><span class="o">.</span><span class="n">scope</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Axes: </span><span class="si">{</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="si">}</span><span class="s1">), </span><span class="si">{</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Get coordinate reference system metadata for including in files</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Climate and Forecast (CF) conventions&#39;</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">5936</span><span class="p">)</span><span class="o">.</span><span class="n">to_cf</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">cf</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Be used to build transformer objects for converting coordinate systems</p></li>
<li><p>And a whole lot more!</p></li>
</ul>
</div>
<div class="section" id="geospatial-data">
<h2>Geospatial Data<a class="headerlink" href="#geospatial-data" title="Permalink to this headline">¶</a></h2>
<p>What is Geospatial Data?  Data that has location information associated with it.</p>
<p>Geospatial data comes in two flavors: <em>vector</em> and <em>raster</em></p>
<ul class="simple">
<li><p>Vector data is composed of points, lines, and polygons</p></li>
<li><p>Raster data is composed of individual grid cells</p></li>
</ul>
<p><a class="reference external" href="https://developers.planet.com/planetschool/geospatial-data/"><img alt="Vector vs. Raster" src="https://developers.planet.com/planetschool/images/vectorraster.png" /></a></p>
<p><em>Vector vs. Raster from <a class="reference external" href="https://developers.planet.com/planetschool">Planet School</a></em></p>
<div class="section" id="q-when-would-we-use-vector-over-raster">
<h3><strong>Q: When would we use vector over raster?</strong><a class="headerlink" href="#q-when-would-we-use-vector-over-raster" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="q-when-would-we-use-raster-over-vector">
<h3><strong>Q: When would we use raster over vector?</strong><a class="headerlink" href="#q-when-would-we-use-raster-over-vector" title="Permalink to this headline">¶</a></h3>
<p>Vector data will provide geometric information for every point or vertex in the geometry.</p>
<p>Raster data will provide geometric information for a particular corner, which can be combined with the grid cell sizes and grid dimensions to get the grid cell coordinates.</p>
<p>Common vector file formats:</p>
<ul class="simple">
<li><p>GeoJSON</p></li>
<li><p>shapefile</p></li>
<li><p>GeoPackage</p></li>
<li><p>ESRI geodatabase</p></li>
<li><p>kml/kmz</p></li>
</ul>
<p>Common raster file formats:</p>
<ul class="simple">
<li><p>geotiff/cog</p></li>
<li><p>jpeg</p></li>
<li><p>png</p></li>
<li><p>netCDF</p></li>
<li><p>HDF5</p></li>
</ul>
<p>All geospatial data (raster and vector) should have metadata for extracting the coordinate reference system of the data.  Some of this metadata is not included with the files but can be found in the documentation.</p>
</div>
<div class="section" id="q-are-you-more-familiar-with-using-vector-or-raster-data">
<h3><strong>Q: Are you more familiar with using vector or raster data?</strong><a class="headerlink" href="#q-are-you-more-familiar-with-using-vector-or-raster-data" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="q-do-you-more-often-use-gis-software-or-command-line-tools">
<h3><strong>Q: Do you more often use GIS software or command-line tools?</strong><a class="headerlink" href="#q-do-you-more-often-use-gis-software-or-command-line-tools" title="Permalink to this headline">¶</a></h3>
<p>There are different tools for working with raster and vector data.  Some are more advantageous for one data type over the other.</p>
<p>Let’s find the coordinate reference system of some data products using some common geospatial tools.</p>
</div>
</div>
<div class="section" id="geospatial-data-abstraction-library">
<h2>Geospatial Data Abstraction Library<a class="headerlink" href="#geospatial-data-abstraction-library" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://gdal.org/">Geospatial Data Abstraction Library (GDAL/OGR)</a> is a powerful piece of software.</p>
<p>It can read, write and query a wide variety of raster and vector geospatial data formats, transform the coordinate system of images, and manipulate other forms of geospatial data.</p>
<p>It is the backbone of a <em>large</em> suite of geospatial libraries and programs.</p>
<!-- It can also be an absolute pain in the neck to install, particularly if you are wanting specific drivers not included in the [default installation](https://trac.osgeo.org/gdal/wiki/BuildingOnUnix).-->
<p>There are a number of wrapper libraries (e.g. <a class="reference external" href="https://rasterio.readthedocs.io/">rasterio</a>, <a class="reference external" href="https://corteva.github.io/rioxarray">rioxarray</a>, <a class="reference external" href="https://shapely.readthedocs.io/">shapely</a>, <a class="reference external" href="https://fiona.readthedocs.io/">fiona</a>) that provide more user-friendly interfaces with GDAL functionality.</p>
<p>Similar to pyproj CRS objects, GDAL <code class="docutils literal notranslate"><span class="pre">SpatialReference</span></code> functions can provide a lot of information about a particular Coordinate Reference System</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">crs_attributes</span><span class="p">(</span><span class="n">srs_proj4</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">srs_wkt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">srs_epsg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary of attributes for a projection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># output projection attributes dictionary</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># set the spatial projection reference information</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">osgeo</span><span class="o">.</span><span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">srs_proj4</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sr</span><span class="o">.</span><span class="n">ImportFromProj4</span><span class="p">(</span><span class="n">srs_proj4</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">srs_wkt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sr</span><span class="o">.</span><span class="n">ImportFromWkt</span><span class="p">(</span><span class="n">srs_wkt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">srs_epsg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sr</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="n">srs_epsg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># convert proj4 string to dictionary</span>
    <span class="n">proj4_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\+(.*?)\=([^ ]+)&#39;</span><span class="p">,</span><span class="n">sr</span><span class="o">.</span><span class="n">ExportToProj4</span><span class="p">())}</span>
    <span class="c1"># get projection attributes</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;spatial_epsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;AUTHORITY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;crs_wkt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;spatial_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;proj4_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">ExportToProj4</span><span class="p">()</span>
    <span class="c1"># get datum attributes</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;semi_major_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetSemiMajor</span><span class="p">()</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;semi_minor_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetSemiMinor</span><span class="p">()</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;inverse_flattening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetInvFlattening</span><span class="p">()</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;reference_ellipsoid_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;DATUM&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;geographic_crs_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;GEOGCS&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># get projection attributes</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;projected_crs_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;grid_mapping_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;PROJECTION&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;PROJECTION&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;prime_meridian_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;PRIMEM&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;longitude_of_prime_meridian&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;PRIMEM&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">proj4_dict</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;standard_parallel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetProjParm</span><span class="p">(</span><span class="n">osgeo</span><span class="o">.</span><span class="n">osr</span><span class="o">.</span><span class="n">SRS_PP_LATITUDE_OF_ORIGIN</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;straight_vertical_longitude_from_pole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetProjParm</span><span class="p">(</span><span class="n">osgeo</span><span class="o">.</span><span class="n">osr</span><span class="o">.</span><span class="n">SRS_PP_CENTRAL_MERIDIAN</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;false_northing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetProjParm</span><span class="p">(</span><span class="n">osgeo</span><span class="o">.</span><span class="n">osr</span><span class="o">.</span><span class="n">SRS_PP_FALSE_NORTHING</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;false_easting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetProjParm</span><span class="p">(</span><span class="n">osgeo</span><span class="o">.</span><span class="n">osr</span><span class="o">.</span><span class="n">SRS_PP_FALSE_EASTING</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">crs</span><span class="p">[</span><span class="s1">&#39;scale_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">GetProjParm</span><span class="p">(</span><span class="n">osgeo</span><span class="o">.</span><span class="n">osr</span><span class="o">.</span><span class="n">SRS_PP_SCALE_FACTOR</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">crs_attributes</span><span class="p">(</span><span class="n">srs_epsg</span><span class="o">=</span><span class="mi">5936</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>GDAL command-line utilities also allows for quick inspection of Coordinate Reference Systems (CRS) and geospatial data files</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> gdalsrsinfo EPSG:5936
</pre></div>
</div>
</div>
</div>
<p>With GDAL, we can access raster and vector data that are available over network-based file systems and virtual file systems</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/vsicurl/</span></code>: http/https/ftp files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsis3/</span></code>: AWS S3 files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsigs/</span></code>: Google Cloud Storage files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsizip/</span></code>: zip archives</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsitar/</span></code>: tar/tgz archives</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsigzip/</span></code>: gzipped files</p></li>
</ul>
<p>These can be chained together to access compressed files over networks</p>
<p>GDAL environment variables can often have a large impact on performance when reading data via URLs. For example <code class="docutils literal notranslate"><span class="pre">GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR</span></code> disables scanning directories, which is very fast on a local file system, but very slow when querying a server.</p>
</div>
<div class="section" id="vector-data">
<h2>Vector Data<a class="headerlink" href="#vector-data" title="Permalink to this headline">¶</a></h2>
<p>We can use GDAL virtual file systems to access the intermediate resolution shapefile of the <a class="reference external" href="https://www.soest.hawaii.edu/pwessel/gshhg/">Global Self-consistent, Hierarchical, High-resolution Geography Database</a> from its https server.</p>
<p><code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> is a GDAL/OGR tool for inspecting vector data.  We’ll get a summary (<code class="docutils literal notranslate"><span class="pre">-so</span></code>) of all data (<code class="docutils literal notranslate"><span class="pre">-al</span></code>) in read-only mode (<code class="docutils literal notranslate"><span class="pre">-ro</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> <span class="nv">GDAL_DISABLE_READDIR_ON_OPEN</span><span class="o">=</span>EMPTY_DIR ogrinfo -ro -al -so <span class="s1">&#39;/vsizip//vsicurl/http://www.soest.hawaii.edu/pwessel/gshhg/gshhg-shp-2.3.7.zip/GSHHS_shp/i/GSHHS_i_L1.shp&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>So from <code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> we can see that this shapefile is in <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span></code> (WGS84 Latitude/Longitude).</p>
<p>We can read these shapefiles using geopandas, which uses a wrapper of GDAL/OGR for reading vector data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1">#CPU times: user 1.51 s, sys: 114 ms, total: 1.63 s</span>
<span class="c1">#Wall time: 5.97 s</span>

<span class="c1">#1.65 later due to caching</span>

<span class="n">gshhg</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;/vsizip//vsicurl/http://www.soest.hawaii.edu/pwessel/gshhg/gshhg-shp-2.3.7.zip/GSHHS_shp/i/GSHHS_i_L1.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gshhg</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use these coastlines to make a plot of Greenland in a <a class="reference external" href="https://epsg.io/3413">Polar Stereographic projection (EPSG:3413)</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">crs3413</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">3413</span><span class="p">)</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1530000</span><span class="p">,</span> <span class="mi">1610000</span><span class="p">,</span><span class="o">-</span><span class="mi">3600000</span><span class="p">,</span> <span class="o">-</span><span class="mi">280000</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">gshhg</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs3413</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">crs3413</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Even with intermediate resolution, we can add much better coastlines than the ones that ship with geopandas!</p>
<p>All coastline resolutions available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code>: coarse</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l</span></code>: low</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code>: intermediate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code>: high</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code>: full</p></li>
</ul>
</div>
<div class="section" id="raster-data">
<h2>Raster Data<a class="headerlink" href="#raster-data" title="Permalink to this headline">¶</a></h2>
<p>The same virtual file system commands can be used with raster images.</p>
<p>Let’s inspect some geotiff imagery from the Landsat program.</p>
<p><code class="docutils literal notranslate"><span class="pre">gdalinfo</span></code> allows us to inspect the format, size, geolocation and Coordinate Reference System of raster imagery.  Appending the <code class="docutils literal notranslate"><span class="pre">-proj4</span></code> option will additionally output the PROJ string associated with this geotiff image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> <span class="nv">GDAL_DISABLE_READDIR_ON_OPEN</span><span class="o">=</span>EMPTY_DIR gdalinfo -proj4 <span class="s2">&quot;/vsicurl/https://storage.googleapis.com/gcp-public-data-landsat/LC08/01/046/027/LC08_L1TP_046027_20181224_20190129_01_T1/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>This image is projected in Universal Transverse Mercator (UTM), which divides the Earth into <a class="reference external" href="https://pubs.usgs.gov/fs/2001/0077/report.pdf">60 north-south oriented zones</a> (each 6° longitude wide).</p>
<p>We can read geotiff files using rasterio, which is a wrapper of GDAL for reading raster data</p>
<p>Let’s find out where this image is by <em>warping</em> the outline of the image to latitude and longitude coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Environment variables in Python can be set via the &#39;os&#39; library</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;GDAL_DISABLE_READDIR_ON_OPEN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;EMPTY_DIR&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/vsicurl/https://storage.googleapis.com/gcp-public-data-landsat/LC08/01/046/027/LC08_L1TP_046027_20181224_20190129_01_T1/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF&quot;</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># read the valid data mask as a ndarray.</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dataset_mask</span><span class="p">()</span>
    <span class="c1"># extract feature shapes and values from the array.</span>
    <span class="k">for</span> <span class="n">geom</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">transform</span><span class="p">):</span>
        <span class="c1"># transform shapes to EPSG:4326</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">transform_geom</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># plot location of landsat image</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.375</span><span class="p">,</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">,</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
    <span class="c1"># add geometry of image</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="c1"># add annotation</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">get_xy</span><span class="p">(),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Here!&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">15.0</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span><span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=0.3&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span>
        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="c1"># add coastlines</span>
    <span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span>
    <span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="c1"># set x and y limits</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span><span class="n">maxlon</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minlat</span><span class="p">,</span><span class="n">maxlat</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="c1"># add x and y labels</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="c1"># adjust subplot and show</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Okay! It covers Western Washington and the University of Washington.</p>
<p>Let’s see what this image looks like first in the original image coordinates (UTM)</p>
<p>We’ll read the image data using rasterio and plot it directly with matplotlib</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/vsicurl/https://storage.googleapis.com/gcp-public-data-landsat/LC08/01/046/027/LC08_L1TP_046027_20181224_20190129_01_T1/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF&quot;</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="c1"># read image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">width</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">fill_value</span>
    <span class="c1"># save the coordinate reference system and transform</span>
    <span class="n">src_crs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">crs</span>
    <span class="n">src_transform</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">transform</span>

    <span class="c1"># create figure axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:],</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">),</span>
        <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
    <span class="c1"># set x and y limits</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
    <span class="c1"># turn of frame and ticks</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># adjust subplot within figure</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="warping-raster-imagery">
<h2>Warping Raster Imagery<a class="headerlink" href="#warping-raster-imagery" title="Permalink to this headline">¶</a></h2>
<p><em>Warping</em> transfers a raster image from one Coordinate Reference System (CRS) into another.</p>
<p>We can use <a class="reference external" href="https://gdal.org/programs/gdalwarp.html">GDAL to reproject the imagery data</a> into another CRS or change the pixel resolution of the raster image.</p>
<p>Ground control points (GCPs) can also be applied to georeference raw maps or imagery.</p>
<p><img alt="ESRI warp" src="https://www.esri.com/about/newsroom/wp-content/uploads/2018/07/auspr18_Georefer_2.gif" /></p>
<p><em>Raster Georeferencing from <a class="reference external" href="https://www.esri.com/about/newsroom/arcuser/understanding-raster-georeferencing/">ESRI</a></em></p>
<p><code class="docutils literal notranslate"><span class="pre">gdalwarp</span></code> is a GDAL tool for warping raster data.  We’ll warp this image into <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span></code> (WGS84 Latitude/Longitude) using bilinear interpolation as the resampling method (<code class="docutils literal notranslate"><span class="pre">-r</span></code>).  We’ll set the target extent (<code class="docutils literal notranslate"><span class="pre">-te</span></code>) and target resolution (<code class="docutils literal notranslate"><span class="pre">-tr</span></code>) of our output geotiff image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
# remove any previous instance of file
if [ -f LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF ]; then
  rm -v LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF
fi
# warp landsat image using GDAL command line tools
export url=&quot;/vsicurl/https://storage.googleapis.com/gcp-public-data-landsat/LC08/01/046/027/LC08_L1TP_046027_20181224_20190129_01_T1/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF&quot;
gdalwarp -co &quot;COMPRESS=LZW&quot; -te -124 46 -120 49 -tr 0.01 0.01 \
   -t_srs EPSG:4326 -srcnodata 0 -dstnodata 0 \
   -r bilinear ${url} /tmp/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF
ls -lh /tmp/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/tmp/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="c1"># read warped landsat image</span>
    <span class="n">warped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">width</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">warped</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">warped</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>
    <span class="n">warped</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">warped</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">warped</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">warped</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">warped</span><span class="o">.</span><span class="n">fill_value</span>
    <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># plot warped landsat image</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.375</span><span class="p">,</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="c1"># add geometry of image</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">warped</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:],</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">),</span>
        <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
    <span class="c1"># add coastlines</span>
    <span class="n">gshhg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="c1"># set x and y limits</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ymax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="c1"># add x and y labels</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="c1"># adjust subplot and show</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Q: can we do this directly with rasterio?</p>
<p>Yes!</p>
</div>
<div class="section" id="rasterio-transforms">
<h2>Rasterio Transforms<a class="headerlink" href="#rasterio-transforms" title="Permalink to this headline">¶</a></h2>
<p>For every rasterio object, there is an associated <em>affine transform</em> (<code class="docutils literal notranslate"><span class="pre">ds.transform</span></code>), which allows you to <a class="reference external" href="https://rasterio.readthedocs.io/en/latest/quickstart.html#dataset-georeferencing">transfer from image coordinates to geospatial coordinates</a>.</p>
<p align="center">
$
x = A*row + B*col + C\\
y = D*row + E*col + F
$
</p>
<p><em>Affine Transformation</em>: maps between pixel locations in <code class="docutils literal notranslate"><span class="pre">(row,</span> <span class="pre">col)</span></code> coordinates to <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code> spatial positions:</p>
<p><code class="docutils literal notranslate"><span class="pre">x,y</span> <span class="pre">=</span> <span class="pre">ds.transform*(row,col)</span></code></p>
<p>Upper left coordinate:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">row</span> <span class="pre">=</span> <span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col</span> <span class="pre">=</span> <span class="pre">0</span></code></p></li>
</ul>
<p>Lower right coordinate:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">row</span> <span class="pre">=</span> <span class="pre">ds.width</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col</span> <span class="pre">=</span> <span class="pre">ds.height</span></code></p></li>
</ul>
<p><img alt="ESRI affine" src="https://www.esri.com/about/newsroom/wp-content/uploads/2018/07/aufall18_Georefer_1.gif" /></p>
<p><em>Raster Georeferencing from <a class="reference external" href="https://www.esri.com/about/newsroom/arcuser/understanding-raster-georeferencing/">ESRI</a></em></p>
<p>We use the affine transformations for warping our raster image into <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span></code> (WGS84 Latitude/Longitude).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># transform image to EPSG:4326</span>
<span class="n">warped</span><span class="p">,</span><span class="n">affine</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">src_transform</span><span class="o">=</span><span class="n">src_transform</span><span class="p">,</span>
  <span class="n">src_crs</span><span class="o">=</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">src_nodata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">crs4326</span><span class="p">,</span>
  <span class="n">dst_resolution</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">resampling</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">enums</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span><span class="p">)</span>
<span class="n">dst_count</span><span class="p">,</span><span class="n">dst_height</span><span class="p">,</span><span class="n">dst_width</span> <span class="o">=</span> <span class="n">warped</span><span class="o">.</span><span class="n">shape</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">affine</span><span class="o">*</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">affine</span><span class="o">*</span><span class="p">(</span><span class="n">dst_width</span><span class="p">,</span><span class="n">dst_height</span><span class="p">)</span>
<span class="c1"># convert to masked array with fill values</span>
<span class="n">warped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">warped</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">warped</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">warped</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">warped</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">warped</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">warped</span><span class="o">.</span><span class="n">fill_value</span>

<span class="c1"># plot warped landsat image</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.375</span><span class="p">,</span><span class="mf">5.0</span><span class="p">))</span>
<span class="c1"># add geometry of image</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">warped</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:],</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">),</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">gshhg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ymax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="saving-raster-data-with-rasterio">
<h2>Saving Raster Data with Rasterio<a class="headerlink" href="#saving-raster-data-with-rasterio" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># write an array as a raster band</span>
<span class="n">profile</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">warped</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="n">nodata</span><span class="o">=</span><span class="n">warped</span><span class="o">.</span><span class="n">fill_value</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">dst_width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">dst_height</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="n">dst_count</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="n">crs4326</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">affine</span>
<span class="p">)</span>

<span class="c1"># Save to scratch space instead of within limited home directory</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/tmp/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warped</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> gdalinfo /tmp/LC08_L1TP_046027_20181224_20190129_01_T1_B8.TIF
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="climate-and-forecast-cf-metadata-conventions">
<h2>Climate and Forecast (CF) Metadata Conventions<a class="headerlink" href="#climate-and-forecast-cf-metadata-conventions" title="Permalink to this headline">¶</a></h2>
<p>NASA adopted the <a class="reference external" href="http://cfconventions.org/">Climate and Forecast (CF) conventions</a> as the <a class="reference external" href="https://earthdata.nasa.gov/esdis/esco/standards-and-references/climate-and-forecast-cf-metadata-conventions">standard for NASA Science Data Systems (SDS)</a>.  The CF metadata standards were designed to ease the processing and sharing of Earth sciences netCDF data.  It follows and extends geospatial data guidelines and standards from the <a class="reference external" href="https://www.fgdc.gov/standards/projects/FGDC-standards-projects/metadata/base-metadata/v2_0698.pdf">Federal Geographic Data Committee (FGDC)</a>, <a class="reference external" href="https://ferret.pmel.noaa.gov/noaa_coop/coop_cdf_profile.html">Cooperative Ocean/Atmosphere Research Data Service (COARDS)</a>, and other earlier sources, such as the Gregory/Drach/Tett (GDT) conventions.</p>
<p>For grid fields in netCDF files following CF standards, there is a variable attribute named <code class="docutils literal notranslate"><span class="pre">grid_mapping</span></code>.  This attribute contains the name of the variable describing the Coordinate Reference System (CRS) of the geospatial field.</p>
<p>Common attributes for a <a class="reference external" href="https://cfconventions.org/">CF grid mapping variable</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grid_mapping_name</span></code>: <a class="reference external" href="https://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/build/apf.html">name of the grid mapping</a>  <em>(required)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">crs_wkt</span></code>: Well-Known Text (WKT) of the Coordinate Reference System (CRS)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semi_major_axis</span></code>: semi-major axis of the ellipsoid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semi_minor_axis</span></code>: semi-minor axis of the ellipsoid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inverse_flattening</span></code>: ellipsoidal flattening <!--(difference between the semi-major axis and the semi-minor axis divided by the semi-major axis)--></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_ellipsoid_name</span></code>: name of the ellipsoid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geographic_crs_name</span></code>: name of the geographic coordinate reference system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">longitude_of_prime_meridian</span></code>: longitude of the Prime Meridian</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prime_meridian_name</span></code>: name of the Prime Meridian</p></li>
</ul>
<p>In ICESat-2 ATL15 gridded land ice height change products, the data is separated into individual groups:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">delta_h</span></code>: group with height anomalies at quarterly time steps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dhdt_lag1</span></code>: group with height difference rates between quarterly time steps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dhdt_lag4</span></code>: group with annual height change rates at quarterly time steps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dhdt_lag8</span></code>: group with biennial height change rates at quarterly time steps</p></li>
</ul>
<p>These groups each contain a <code class="docutils literal notranslate"><span class="pre">grid_mapping</span></code> variable <code class="docutils literal notranslate"><span class="pre">polar_stereographic</span></code> that contains the CF standard Coordinate Reference System (CRS) attributes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utilities</span><span class="o">.</span><span class="n">attempt_login</span><span class="p">(</span><span class="s1">&#39;urs.earthdata.nasa.gov&#39;</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># query CMR for ATL15 files</span>
<span class="n">ids</span><span class="p">,</span><span class="n">urls</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">cmr</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ATL15&#39;</span><span class="p">,</span><span class="n">regions</span><span class="o">=</span><span class="s1">&#39;GL&#39;</span><span class="p">,</span><span class="n">resolutions</span><span class="o">=</span><span class="s1">&#39;10km&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">buffer</span><span class="p">,</span><span class="n">response_error</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">from_nsidc</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">local</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="c1"># open the ATL15 netCDF4 file with xarray</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;dhdt_lag8&#39;</span><span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="c1"># get coordinate reference system of ATL15</span>
<span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;dhdt&#39;</span>
<span class="n">grid_mapping_name</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">grid_mapping</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_wkt</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">grid_mapping_name</span><span class="p">]</span><span class="o">.</span><span class="n">crs_wkt</span><span class="p">)</span>
<span class="c1"># extents of output image</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1530000</span><span class="p">,</span> <span class="mi">1610000</span><span class="p">,</span><span class="o">-</span><span class="mi">3600000</span><span class="p">,</span> <span class="o">-</span><span class="mi">280000</span><span class="p">)</span>
<span class="c1"># extents of ATL15 image</span>
<span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="c1"># get vmin and vmax from all ATL15 values</span>
<span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">))</span>
<span class="c1"># add ATL15 image for field</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:],</span>
    <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">),</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="c1"># add coastlines</span>
<span class="n">gshhg</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="c1"># add colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.86</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]),</span>
    <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">solids</span><span class="o">.</span><span class="n">set_rasterized</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># adjust subplot and show</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="converting-netcdf4-to-cloud-optimized-geotiff-cog">
<h2>Converting netCDF4 to Cloud Optimized GeoTIFF (COG)<a class="headerlink" href="#converting-netcdf4-to-cloud-optimized-geotiff-cog" title="Permalink to this headline">¶</a></h2>
<p>GDAL has a translation tool for converting raster data between different formats.  If GDAL is compiled with the netCDF4 driver, then fields from gridded ICESat-2 land ice height files can be converted to other raster formats (such as GeoTIFFs) because the files contain the necessary CRS metadata.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
gdal_translate -co &quot;COMPRESS=LZW&quot; -co &quot;BIGTIFF=YES&quot; \
  NETCDF:/tmp/ATL15_GL_0311_10km_001_01.nc:delta_h/delta_h \
  -of &#39;cog&#39; /tmp/ATL15_GL_delta_h_0311_10km_001_01.tif
gdalinfo -proj4 -nomd /tmp/ATL15_GL_delta_h_0311_10km_001_01.tif
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="combining-concepts-comparing-datasets">
<h2>Combining Concepts: Comparing Datasets<a class="headerlink" href="#combining-concepts-comparing-datasets" title="Permalink to this headline">¶</a></h2>
<p>Here, we’re going to combine some concepts of geospatial transforms for ICESat-2 applications</p>
<p>First, we’ll download a granule of ICESat-2 ATL06 land ice heights for a region of Antarctica</p>
<p>This is <em>along-track</em> data stored in an HDF5 file with geospatial coordinates latitude and longtude (WGS84)</p>
<p>We’ll download the HDF5 data from the <a class="reference external" href="https://nsidc.org/data/atl06">National Snow and Ice Data Center (NSIDC)</a>, and merge it into a single GeoDataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># query CMR for ATL06 files</span>
<span class="n">ids</span><span class="p">,</span><span class="n">urls</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">cmr</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ATL06&#39;</span><span class="p">,</span><span class="n">release</span><span class="o">=</span><span class="s1">&#39;005&#39;</span><span class="p">,</span><span class="n">cycles</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">tracks</span><span class="o">=</span><span class="mi">483</span><span class="p">,</span><span class="n">granules</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># ICESat-2 ATL06 files as geodataframe</span>
<span class="n">atl06</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">([],[]),</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:7661&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="c1"># read ATL06 as in-memory file-like object</span>
    <span class="n">buffer</span><span class="p">,</span><span class="n">response_error</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">from_nsidc</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">atl06</span> <span class="o">=</span> <span class="n">atl06</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ATL06_to_dataframe</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[],</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:7661&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll overlay our ICESat-2 data on top of the Reference Elevation Model of Antarctica (REMA), a high resolution Digital Elevation Model (DEM)</p>
<p>The 8m REMA DEM mosaic is tiled into 1,524 individual geotiff files.</p>
<p>We’ll start by reading the REMA tile index, a vector file containing the bounds of each DEM tile.  The vector and raster data are both in <a class="reference external" href="https://epsg.io/3031">Antarctic Polar Stereographic (EPSG:3031)</a> projections.</p>
<p>We’ll project our ICESat-2 data to this projection, and <em>intersect</em> the ICESat-2 geolocations with the polygon bounds of each tile.  This will give us the tiles that we could need to read to compare with our ICESat-2 data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rema</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;/vsizip//vsicurl/https://data.pgc.umn.edu/elev/dem/setsm/REMA/indexes/REMA_Tile_Index_Rel1.1.zip&#39;</span><span class="p">)</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">atl06</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">rema</span><span class="o">.</span><span class="n">crs</span><span class="p">),</span> <span class="n">rema</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;intersects&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3100000</span><span class="p">,</span><span class="mi">3100000</span><span class="p">,</span><span class="o">-</span><span class="mi">2600000</span><span class="p">,</span><span class="mi">2600000</span><span class="p">)</span> 
<span class="c1"># add coastlines</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">rema</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># add polygons of REMA outputs</span>
<span class="n">rema</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">)</span>
<span class="c1"># add scatter plot of ATL06 data marked by REMA bin</span>
<span class="n">legend_kwds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tiles</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;tile&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral&#39;</span><span class="p">),</span>
   <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_kwds</span><span class="o">=</span><span class="n">legend_kwds</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">rema</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3100000</span><span class="p">,</span><span class="mi">3100000</span><span class="p">,</span><span class="o">-</span><span class="mi">2600000</span><span class="p">,</span><span class="mi">2600000</span><span class="p">)</span> 
<span class="c1"># iterate over unique tiles</span>
<span class="n">unique</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="c1"># for time let&#39;s just use a single tile</span>
<span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># # range of land ice heights</span>
<span class="c1"># vmin,vmax = (atl06.h_li.min(),atl06.h_li.max())</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">unique</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;fileurl&#39;</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/vsitar//vsicurl/</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_dem.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="c1"># read image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">width</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fill_value</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">mask</span><span class="p">[(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">image</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">fill_value</span>
        <span class="c1"># save the coordinate reference system, transform and extents</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">crs</span>
        <span class="n">src_transform</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">transform</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="c1"># indices for ATL06 data points</span>
        <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atl06</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">atl06</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># range of REMA heights</span>
<span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="c1"># create image axis</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:],</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="c1"># add scatter plot of ATL06 height data</span>
<span class="n">atl06</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">rema</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;h_li&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">10e3</span><span class="p">,</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">10e3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mf">10e3</span><span class="p">,</span><span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mf">10e3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">rema</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="c1"># add colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">]))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height Above WGS84 Ellipsoid [m]&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">solids</span><span class="o">.</span><span class="n">set_rasterized</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># add legend</span>
<span class="n">lgd</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lgd</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lgd</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lgd</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()):</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create figure of Antarctica</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="c1"># reduce indices to valid values</span>
<span class="n">_</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">valid</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">)</span> <span class="o">&amp;</span> 
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">width</span><span class="p">))</span>
<span class="n">irow</span><span class="p">,</span><span class="n">icol</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span><span class="n">col</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
<span class="c1"># calculate differences from REMA using nearest-neighbors</span>
<span class="n">atl06</span><span class="p">[</span><span class="s1">&#39;h_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">irow</span><span class="p">,</span><span class="n">icol</span><span class="p">]</span> <span class="o">-</span> <span class="n">atl06</span><span class="p">[</span><span class="s1">&#39;h_li&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># add scatter plot of ATL06 land ice height differences</span>
<span class="n">legend_label</span> <span class="o">=</span> <span class="s1">&#39;Height Difference from REMA [m]&#39;</span>
<span class="n">atl06</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs3031</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;h_diff&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;PRGn&#39;</span><span class="p">),</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.90</span><span class="p">))</span>
<span class="c1"># set x and y limits</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">10e3</span><span class="p">,</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">10e3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mf">10e3</span><span class="p">,</span><span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mf">10e3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="c1"># add x and y labels</span>
<span class="n">x_info</span><span class="p">,</span><span class="n">y_info</span> <span class="o">=</span> <span class="n">crs3031</span><span class="o">.</span><span class="n">axis_info</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">x_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">y_info</span><span class="o">.</span><span class="n">unit_name</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="q-how-could-we-improve-the-comparison">
<h3><strong>Q: How could we improve the comparison?</strong><a class="headerlink" href="#q-how-could-we-improve-the-comparison" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Below is an alphabetical list to all the great open source libraries we used in this notebook</p>
<ul class="simple">
<li><p><a class="reference external" href="https://geopandas.org/en/stable/">geopandas: for geospatial vector data</a></p></li>
<li><p><a class="reference external" href="https://trac.osgeo.org/geos">GEOS: geometry, spatial operations</a></p></li>
<li><p><a class="reference external" href="https://gdal.org">GDAL/OGR: Pythonic interface to the Geospatial Data Abstraction Library (GDAL)</a></p></li>
<li><p><a class="reference external" href="https://fiona.readthedocs.io">fiona: Python wrapper for vector data access functions from the OGR library</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org">matplotlib: visualizations and publication-quality plots</a></p></li>
<li><p><a class="reference external" href="http://www.numpy.org">numpy: Scientific Computing Tools For Python</a></p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org">pandas: Python Data Analysis Library</a></p></li>
<li><p><a class="reference external" href="https://proj.org">PROJ: cartographic projection and coordinate transformation library</a></p></li>
<li><p><a class="reference external" href="https://pyproj4.github.io/pyproj">pyproj: Python interface to PROJ library</a></p></li>
<li><p><a class="reference external" href="https://shapely.readthedocs.io">shapely: PostGIS-ish operations outside a database context for Python</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/geospatial"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="geospatial-intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Geospatial Transforms</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interactive Visualizion with Open Altimetry &amp; Google Earth Engine</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By eScience Institute, University of Washington<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>