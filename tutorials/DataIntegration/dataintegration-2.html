
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data integration with ICESat-2 - Part II &#8212; ICESat-2 Hackweek 2022</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Projects" href="../../projects/index.html" />
    <link rel="prev" title="Data integration with ICESat-2 - Part I" href="dataintegration-1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LZVEY6377Z"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-LZVEY6377Z');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ICESat-2 Hackweek 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to ICESat-2 Hackweek!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Details
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../application.html">
   Application
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=schedule">
   Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=team">
   Team
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../mission.html">
   Hackweek Mission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../CoC.html">
   Event Code of Conduct
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preparation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../preliminary/index.html">
   Preliminary Work
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/swc.html">
     Software Carpentry Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/github.html">
     GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/jupyterhub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/git.html">
     Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthdata.html">
     Earthdata Login
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthengine.html">
     Google Earth Engine Sign-Up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/python.html">
     Python Installation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter.html">
     GitHub, Git, JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataProducts/DataProducts.html">
     ICESat-2 data products
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../geospatial/geospatial-intro.html">
     Geospatial Transforms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../geospatial/geospatial-advanced.html">
       Geospatial Transformations In-depth
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dataintegration-1.html">
     Data integration with ICESat-2 - Part I
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Data integration with ICESat-2 - Part II
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../projects/index.html">
   Projects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roles.html">
     Project Roles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roadmap.html">
     Project Roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_initialization.html">
     Project Initialization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/list_of_projects.html">
     List of Projects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/glossary.html">
   Glossaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_source_software.html">
   Open-source Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/questions.html">
   How to Get Help
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tutorials/DataIntegration/dataintegration-2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ICESAT-2HackWeek/website2022"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ICESAT-2HackWeek/website2022/issues/new?title=Issue%20on%20page%20%2Ftutorials/DataIntegration/dataintegration-2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ICESAT-2HackWeek/website2022/edit/main/book/tutorials/DataIntegration/dataintegration-2.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ICESAT-2HackWeek/website2022/main?urlpath=lab/tree/book/tutorials/DataIntegration/dataintegration-2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Data integration with ICESat-2 - Part II
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#libraries-need-to-add">
     Libraries need to add:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nsidc-login">
     NSIDC Login
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#termini">
     Termini
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flowines">
     Flowines
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-flowlines-and-termini">
     Plot Flowlines and Termini
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-icesat-2-data-with-other-datasets">
   Comparing ICESat-2 Data with Other Datasets
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-flowines-using-remote-greenland-ice-mapping-project-data">
   Plot Flowines Using Remote Greenland Ice Mapping Project Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-shapefiles">
     Read Shapefiles
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-catalog-for-velocity-data">
     Search Catalog for Velocity Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-velocity-data">
     Load the Velocity Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview-images">
     Overview Images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-flowlines-and-velocity">
     Display Flowlines and Velocity
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpolation">
     Interpolation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-central-flowlines-at-different-times">
     Plot Central Flowlines at Different Times
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-points-through-time">
     Plot Points Through Time
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-the-data">
     Save the Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-with-widgets">
   Visualizing with widgets
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data integration with ICESat-2 - Part II</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Data integration with ICESat-2 - Part II
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#libraries-need-to-add">
     Libraries need to add:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nsidc-login">
     NSIDC Login
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#termini">
     Termini
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flowines">
     Flowines
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-flowlines-and-termini">
     Plot Flowlines and Termini
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-icesat-2-data-with-other-datasets">
   Comparing ICESat-2 Data with Other Datasets
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-flowines-using-remote-greenland-ice-mapping-project-data">
   Plot Flowines Using Remote Greenland Ice Mapping Project Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-shapefiles">
     Read Shapefiles
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-catalog-for-velocity-data">
     Search Catalog for Velocity Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-velocity-data">
     Load the Velocity Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview-images">
     Overview Images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-flowlines-and-velocity">
     Display Flowlines and Velocity
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpolation">
     Interpolation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-central-flowlines-at-different-times">
     Plot Central Flowlines at Different Times
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-points-through-time">
     Plot Points Through Time
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-the-data">
     Save the Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-with-widgets">
   Visualizing with widgets
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="data-integration-with-icesat-2-part-ii">
<h1>Data integration with ICESat-2 - Part II<a class="headerlink" href="#data-integration-with-icesat-2-part-ii" title="Permalink to this headline">¶</a></h1>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning Objectives</p>
<p><strong>Goals</strong></p>
<ul class="simple">
<li><p>Access NSIDC data sets and acquire IS-2 using icepyx</p></li>
<li><p>Analyze point and raster data together with IS-2</p></li>
<li><p>Advanced visualizations of multiple datasets</p></li>
</ul>
</div>
<p>☝️ This formatting is a Jupyter Book <a class="reference external" href="https://jupyterbook.org/content/content-blocks.html#notes-warnings-and-other-admonitions">admonition</a>, that uses a custom version of Markdown called <a class="reference internal" href="../../reference/glossary.html#term-MyST"><span class="xref std std-term">MyST</span></a></p>
<div class="section" id="libraries-need-to-add">
<h2>Libraries need to add:<a class="headerlink" href="#libraries-need-to-add" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>nisardev</p></li>
<li><p>grimpfunc</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span>  <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">fastice</span><span class="o">/</span><span class="n">grimpfunc</span><span class="o">.</span><span class="n">git</span><span class="nd">@master</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">fastice</span><span class="o">/</span><span class="n">nisardev</span><span class="o">.</span><span class="n">git</span><span class="nd">@main</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.lib.deepreload</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">nisardev</span> <span class="k">as</span> <span class="nn">nisar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">grimpfunc</span> <span class="k">as</span> <span class="nn">grimp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>
<span class="kn">import</span> <span class="nn">panel</span>
<span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">ProgressBar</span>
<span class="n">ProgressBar</span><span class="p">()</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">panel</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="nsidc-login">
<h2>NSIDC Login<a class="headerlink" href="#nsidc-login" title="Permalink to this headline">¶</a></h2>
<p>For remote access to the velocity data at NSIDC, run these cells to login with your NASA EarthData Login (see  <a class="reference external" href="https://github.com/fastice/GRiMPNotebooks/blob/master/NSIDCLoginNotebook.ipynb">NSIDCLoginNotebook</a> for further details). These cells can skipped if all data are being accessed locally. First define where the cookie files need for login are saved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">GDAL_HTTP_COOKIEFILE</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.grimp_download_cookiejar.txt&#39;</span><span class="p">),</span>
            <span class="n">GDAL_HTTP_COOKIEJAR</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.grimp_download_cookiejar.txt&#39;</span><span class="p">))</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now enter credentials. If previous valid cookie exists, no user input is needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myLogin</span> <span class="o">=</span> <span class="n">grimp</span><span class="o">.</span><span class="n">NASALogin</span><span class="p">()</span>
<span class="n">myLogin</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="termini">
<h2>Termini<a class="headerlink" href="#termini" title="Permalink to this headline">¶</a></h2>
<p>Locate the files in the NSDIC catalog.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myTerminusUrls</span> <span class="o">=</span> <span class="n">grimp</span><span class="o">.</span><span class="n">cmrUrls</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;terminus&#39;</span><span class="p">)</span>  <span class="c1"># mode image restricts search to the image products</span>
<span class="n">myTerminusUrls</span><span class="o">.</span><span class="n">initialSearch</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>Read in termini and store in a dict, <code class="docutils literal notranslate"><span class="pre">myTermini</span></code>, by year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myTermini</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">myTerminusUrls</span><span class="o">.</span><span class="n">getURLS</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Extract year from name</span>
    <span class="n">myTermini</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/vsicurl/&amp;url=</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Add terminus to data frame</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="flowines">
<h2>Flowines<a class="headerlink" href="#flowines" title="Permalink to this headline">¶</a></h2>
<p>Read flowline by glacier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glaciers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">glaciers</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;000</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shpfiles/glacier000</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.shp&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-flowlines-and-termini">
<h2>Plot Flowlines and Termini<a class="headerlink" href="#plot-flowlines-and-termini" title="Permalink to this headline">¶</a></h2>
<p>Checking everything looks good before ipyleaf.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">myTermini</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">myTermini</span><span class="p">))))}</span>
<span class="c1">#myVelSeries.displayVelForDate(&#39;2020-01-01&#39;, ax=ax, labelFontSize=12, plotFontSize=9, titleFontSize=14, </span>
<span class="c1">#                              vmin=0, vmax=2000, units=&#39;m&#39;, scale=&#39;linear&#39;, colorBarSize=&#39;3%&#39;) </span>
<span class="c1">#</span>
<span class="c1"># Termini - unfortunately numbers are slightly different</span>
<span class="c1">#</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">myTermini</span><span class="p">:</span>
         <span class="n">myTermini</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">myTermini</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Glacier_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">glaciers</span><span class="p">:</span>
    <span class="n">glaciers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">220000.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">127800.0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">2314000.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2219200.0</span><span class="p">))</span>
<span class="c1"># Use years for legends       </span>
<span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span> <span class="c1"># will overwrite identical entries to produce unique values</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="comparing-icesat-2-data-with-other-datasets">
<h1>Comparing ICESat-2 Data with Other Datasets<a class="headerlink" href="#comparing-icesat-2-data-with-other-datasets" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>Last time, we did a bit of work to add ICESat-2 and Operation Icebridge data to Pandas Dataframes. We only covered the basic operations that you can do with Pandas, so today we are going to do a more thorough analysis of the data here.</p>
<p>Since we already downloaded the ICESat-2/ATM files of interest, we are not going to use icepyx just yet - we will go ahead and reload the data from yesterday.</p>
<p>(Prompt) I forgot how to load the ICESat-2 data from a .h5 file. What do I need to do?</p>
<p>(Prompt) I also forgot how to load the ATM data. How do I read the CSV?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>We established last time that ATM aligns best with the central ICESat-2 beams, particularly the central strong beam (GT2L). Let’s see if that is reflected in the elevation profiles…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the ICESat-2 data</span>
<span class="n">is2_file</span> <span class="o">=</span> <span class="s1">&#39;processed_ATL06_20190420093051_03380303_005_01_full.h5&#39;</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">is2_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">is2_gt2r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/latitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/longitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/h_li&#39;</span><span class="p">][:]})</span> <span class="c1"># Central weak beam</span>
    <span class="n">is2_gt2l</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/latitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/longitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/h_li&#39;</span><span class="p">][:]})</span> <span class="c1"># Central strong beam</span>
    
<span class="c1"># Load the ATM data</span>
<span class="n">atm_file</span> <span class="o">=</span> <span class="s1">&#39;ILATM2_20190506_151600_smooth_nadir3seg_50pt.csv&#39;</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atm_file</span><span class="p">)</span>

<span class="c1"># Look only at the nadir track</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Change the longitudes to be consistent with ICESat-2</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset the ICESat-2 data to the ATM latitudes</span>
<span class="n">is2_gt2r</span> <span class="o">=</span> <span class="n">is2_gt2r</span><span class="p">[(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>
<span class="n">is2_gt2l</span> <span class="o">=</span> <span class="n">is2_gt2l</span><span class="p">[(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a 2D plot of along-track surface height</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> widget
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gt2r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gt2l&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">],</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;WGS84_Ellipsoid_Height(m)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;atm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;elevation [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">69.185</span><span class="p">,</span> <span class="mf">69.275</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">550</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Sure enough, GT2L and ATM match very well! Since they are very close to each other, we can do a quick accuracy assessment between the two.</p>
<p>The ATM DataFrame is larger than the ICESat-2 dataframe, so we’re going to apply a simple spline interpolant to downscale the ICESat-2 data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splrep</span><span class="p">,</span><span class="n">splev</span>

<span class="c1"># Apply a spline interpolant to the ICESat-2 data</span>
<span class="n">spl</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">is2_spl</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">],</span> <span class="n">spl</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calculate GT2L bias and add it to the ATM DataFrame</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;WGS84_Ellipsoid_Height(m)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is2_spl</span>

<span class="c1"># Plot the bias curve</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">],</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">])</span>
<span class="c1">#plt.plot(atm_l2[&#39;Latitude(deg)&#39;], atm_l2[&#39;WGS84_Ellipsoid_Height(m)&#39;])</span>
<span class="c1">#plt.plot(atm_l2[&#39;Latitude(deg)&#39;], is2_spl)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;bias [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">69.2</span><span class="p">,</span> <span class="mf">69.26</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean bias: </span><span class="si">%s</span><span class="s1"> m&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<p>Through some relatively simple operations, we found that ATM and ICESat-2 differ by ~0.33 m on average. Between this plot and the elevation plot above, what do you think might be causing some of the differences?</p>
<p>We will revisit ICESat-2 and ATM near the end of this tutorial. Now, we are going to look at ice velocities and flow lines from the GRIMP project.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="plot-flowines-using-remote-greenland-ice-mapping-project-data">
<h1>Plot Flowines Using Remote Greenland Ice Mapping Project Data<a class="headerlink" href="#plot-flowines-using-remote-greenland-ice-mapping-project-data" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>This notebook demonstrates how Greenland Ice Mapping Project can be remotely accessed to create plots along flowlines from <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2020GL090112">Felikson et al., 2020</a>, which are archived on <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2020GL090112">Zenodo</a>. The copies of the shapefiles included in this repository were downloaded in late January 2022. The notebook works with a specific set of glacier ids but is easily modified to plot results for other glaciers in the flowline data set.</p>
<div class="section" id="read-shapefiles">
<h2>Read Shapefiles<a class="headerlink" href="#read-shapefiles" title="Permalink to this headline">¶</a></h2>
<p>In the examples presented here we will use glaciers 1 &amp; 2  in the Felikson data base, <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2020GL090112">Felikson et al., 2020</a>, which were retrieved from <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2020GL090112">Zenodo</a>.</p>
<p>Each glacier’s flowlines are used to create <code class="docutils literal notranslate"><span class="pre">grimp.Flowlines</span></code> instances, which are saved in a dictionary, <code class="docutils literal notranslate"><span class="pre">myFlowlines</span></code> with glacier id: ‘0001’ and  ‘0002’. Each <code class="docutils literal notranslate"><span class="pre">Flowlines</span></code> read a set of flowlines for each glacier and stores in a dictionary of <code class="docutils literal notranslate"><span class="pre">myFlowlines.flowlines</span></code>. The code to do this looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">flowlines</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">shapeTable</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">shapeTable</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  <span class="c1"># loop over features</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># New Flowline</span>
        <span class="n">fl</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">fl</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">fl</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">computeDistance</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">fl</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="n">flowlines</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;flowline&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">fl</span>
</pre></div>
</div>
<p>For further detail, see the full <a class="reference external" href="https://github.com/fastice/grimpfunc/blob/master/grimpfunc/Flowlines.py">class definition</a></p>
<p>To limit the plots to the downstream regions, the flowlines are all truncated to a <code class="docutils literal notranslate"><span class="pre">length</span></code> of 50km.</p>
<p>Within each myFlowines entry (a <code class="docutils literal notranslate"><span class="pre">grimp.Flowlines</span></code> instance), the individual flowlines are maintained as a dictionary <code class="docutils literal notranslate"><span class="pre">myFlowlines['glacierId'].flowlines</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myShapeFiles</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;./shpfiles/glacier000</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.shp&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span> <span class="c1"># Build list of shape file names</span>
<span class="n">myFlowlines</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]:</span> <span class="n">grimp</span><span class="o">.</span><span class="n">Flowlines</span><span class="p">(</span><span class="n">shapefile</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mf">50e3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">myShapeFiles</span><span class="p">}</span> 
<span class="n">myFlowlines</span>
</pre></div>
</div>
</div>
</div>
<p>Each flowline is indexed as shown here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myFlowlines</span><span class="p">[</span><span class="s1">&#39;0001&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flowlines</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The data for the flow line is simple, just <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> polar stereographic coordinates (EPSG=3413) and the distance, <code class="docutils literal notranslate"><span class="pre">d</span></code>, from the start of the flowline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myFlowlines</span><span class="p">[</span><span class="s1">&#39;0001&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flowlines</span><span class="p">[</span><span class="s1">&#39;03&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>These coordinates for a given index can be return as <code class="docutils literal notranslate"><span class="pre">myFlowlines['0001'].xym(index='03')</span></code> or <code class="docutils literal notranslate"><span class="pre">myFlowlines['0001'].xykm(index='03')</span></code></p>
<p>The area of interest can be defined as the union of the bounds for all of the flowlines computed as shown below along with the unique set of flowline IDs across all glaciers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myBounds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;minx&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span> <span class="s1">&#39;miny&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span> <span class="s1">&#39;maxx&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1e9</span><span class="p">,</span> <span class="s1">&#39;maxy&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1e9</span><span class="p">}</span>  <span class="c1"># Initial bounds to force reset</span>
<span class="n">flowlineIDs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># </span>
<span class="k">for</span> <span class="n">myKey</span> <span class="ow">in</span> <span class="n">myFlowlines</span><span class="p">:</span>
    <span class="c1"># Get bounding box for flowlines</span>
    <span class="n">flowlineBounds</span> <span class="o">=</span> <span class="n">myFlowlines</span><span class="p">[</span><span class="n">myKey</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
    <span class="c1"># Merge with prior bounds</span>
    <span class="n">myBounds</span> <span class="o">=</span> <span class="n">myFlowlines</span><span class="p">[</span><span class="n">myKey</span><span class="p">]</span><span class="o">.</span><span class="n">mergeBounds</span><span class="p">(</span><span class="n">myBounds</span><span class="p">,</span> <span class="n">flowlineBounds</span><span class="p">)</span>
    <span class="c1"># Get the flowline ids</span>
    <span class="n">flowlineIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">myKey</span><span class="p">]</span><span class="o">.</span><span class="n">flowlineIDs</span><span class="p">())</span>
<span class="c1"># Get the unique list of flowlines ids (used for legends later)</span>
<span class="n">flowlineIDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">flowlineIDs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">myBounds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flowlineIDs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="search-catalog-for-velocity-data">
<h2>Search Catalog for Velocity Data<a class="headerlink" href="#search-catalog-for-velocity-data" title="Permalink to this headline">¶</a></h2>
<p>We now need to locate velocity data from the GrIMP data set. For this exercise, we will focus on the annual velocity maps of Greenland. To do this, we will use the <code class="docutils literal notranslate"><span class="pre">grimp.cmrUrls</span></code> tool, which will do a GUI based search of NASA’s Common Metadata Repository (<a class="reference external" href="https://earthdata.nasa.gov/eosdis/science-system-description/eosdis-components/cmr">CMR</a>). Search parameters can be passe directly to <code class="docutils literal notranslate"><span class="pre">initialSearch</span></code> method to perform the search.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myUrls</span> <span class="o">=</span> <span class="n">grimp</span><span class="o">.</span><span class="n">cmrUrls</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nisar&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># nisar mode excludes image and tsx products and allows only one product type at a time</span>
<span class="n">myUrls</span><span class="o">.</span><span class="n">initialSearch</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;NSIDC-0725&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">verbose</span></code> flag causes the CMR search string to be printed. The search basically works by a) reading the parameters from the search panel (e.g., product, date, etc) and creating a search string, which returns the search result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://cmr.earthdata.nasa.gov/search/granules.json?provider=NSIDC_ECS&amp;sort_key[]=start_date&amp;sort_key[]=&#39;</span>
                        <span class="s1">&#39;producer_granule_id&amp;scroll=false&amp;page_size=2000&amp;page_num=1&amp;short_name=NSIDC-0725&amp;version=3&amp;temporal[]=&#39;</span>
                        <span class="s1">&#39;2000-01-01T00:00:01Z,2022-03-10T00:23:59&amp;bounding_box[]=-75.00,60.00,-5.00,82.00&amp;producer_granule_id[]=&#39;</span>
                        <span class="s1">&#39;*&amp;options[producer_granule_id][pattern]=true&#39;</span><span class="p">)</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">search_results</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Under the hood, the <code class="docutils literal notranslate"><span class="pre">cmrUrls</span></code> code can filter the json to get a list of urls:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myUrls</span><span class="o">.</span><span class="n">getURLS</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-the-velocity-data">
<h2>Load the Velocity Data<a class="headerlink" href="#load-the-velocity-data" title="Permalink to this headline">¶</a></h2>
<p>GrIMP produces full Greenland velocity maps. Collectively, there are more than 400 full Greenland maps, totalling several hundred GB of data, which may be more than a user interested in a few glaciers wants to download and store on their laptop.  Fortunately using Cloud Optimized Geotiffs, which have the following properties:</p>
<ul class="simple">
<li><p>All the metadata is at the beginning of the file, allowing a single read to obtain the layout.</p></li>
<li><p>The data are tiled (i.e., stored as a series of blocks like a checkerboard) rather than as a line-by-line raster.</p></li>
<li><p>A consistent set of overview images (pyramids) are stored with the data.</p></li>
</ul>
<p>While the velocity data are stored as multiple files at NSIDC, they can all be combined into a single <code class="docutils literal notranslate"><span class="pre">nisarVelSeries</span></code> instance, which has the following properties:</p>
<ul class="simple">
<li><p>Built on Xarray,</p></li>
<li><p>Dask (arallel operations),</p></li>
<li><p>Local and remote subsetting (Lazy Opens), and</p></li>
<li><p>Subsets can be saved for later use</p></li>
</ul>
<p>Before loading the data, we must setup the filename template. Specifically, we must put a ‘*’ where the band identifier would go and remove the trailing ‘.tif’ extension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;vv&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">myUrls</span><span class="o">.</span><span class="n">getCogs</span><span class="p">()]</span> <span class="c1"># getCogs filters to ensure tif products</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myVelSeries</span> <span class="o">=</span> <span class="n">nisar</span><span class="o">.</span><span class="n">nisarVelSeries</span><span class="p">()</span> <span class="c1"># Create Series</span>
<span class="n">myVelSeries</span><span class="o">.</span><span class="n">readSeriesFromTiff</span><span class="p">(</span><span class="n">urlNames</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readSpeed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># readSpeed=False computes speed from vx, vy rather than downloading</span>
<span class="n">myVelSeries</span><span class="o">.</span><span class="n">xr</span>  <span class="c1"># Add semicolon after to suppress output</span>
</pre></div>
</div>
</div>
</div>
<p>For the annual data set, this step produces a ~7GB data sets, which expands to 370GB for the full 6-12-day data set. To avoid downloading unnessary data, the data can be subsetted using the bounding box from the flowlines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myVelSeries</span><span class="o">.</span><span class="n">subSetVel</span><span class="p">(</span><span class="n">myBounds</span><span class="p">)</span> <span class="c1"># Apply subset</span>
<span class="n">myVelSeries</span><span class="o">.</span><span class="n">subset</span> <span class="c1"># Add semicolon after to suppress output</span>
</pre></div>
</div>
</div>
</div>
<p>The volume of the data set is now a far more manageable ~15MB, which is still located in the archive.  Operations can continue without downloading, but if lots of operations are going to occur, it is best to download the data upfront.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myVelSeries</span><span class="o">.</span><span class="n">loadRemote</span><span class="p">()</span> <span class="c1"># Load the data to memory</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="overview-images">
<h2>Overview Images<a class="headerlink" href="#overview-images" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlNames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myOverview</span> <span class="o">=</span> <span class="n">nisar</span><span class="o">.</span><span class="n">nisarVelSeries</span><span class="p">()</span> <span class="c1"># Create Series</span>
<span class="n">myOverview</span><span class="o">.</span><span class="n">readSeriesFromTiff</span><span class="p">([</span><span class="n">urlNames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">url</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readSpeed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overviewLevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># readSpeed=False computes speed from vx, vy rather than downloading</span>
<span class="n">myOverview</span><span class="o">.</span><span class="n">xr</span>  <span class="c1"># Add semicolon after to suppress output</span>
<span class="n">myOverview</span><span class="o">.</span><span class="n">loadRemote</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="display-flowlines-and-velocity">
<h2>Display Flowlines and Velocity<a class="headerlink" href="#display-flowlines-and-velocity" title="Permalink to this headline">¶</a></h2>
<p>The flowlines over one of the velocity layers can be displayed as with the following block of code. In addition to plotting the flowline, a point 10 km along each flowline is plotted and saved for subsequent plots below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up figure and axis</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1"># Create a dictionary for accumulating glacier points</span>
<span class="n">glacierPoints</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># generate a color dict that spans all flowline ids, using method from a flowline instance</span>
<span class="n">flowlineColors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">myFlowlines</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genColorDict</span><span class="p">(</span><span class="n">flowlineIDs</span><span class="o">=</span><span class="n">flowlineIDs</span><span class="p">)</span>
<span class="c1"># Plot velocity maps</span>
<span class="c1"># Saturate at 2000 m/yr to preserve slow detail</span>
<span class="n">myVelSeries</span><span class="o">.</span><span class="n">displayVelForDate</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labelFontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">plotFontSize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">titleFontSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> 
                              <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">colorBarSize</span><span class="o">=</span><span class="s1">&#39;3%&#39;</span><span class="p">)</span> 
<span class="n">myVelSeries</span><span class="o">.</span><span class="n">displayVelForDate</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">labelFontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">plotFontSize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">titleFontSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> 
                              <span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">midDate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorBarSize</span><span class="o">=</span><span class="s1">&#39;3%&#39;</span><span class="p">)</span>
<span class="c1"># Plot location inset</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">axInset</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">height</span> <span class="o">*</span> <span class="n">myOverview</span><span class="o">.</span><span class="n">sx</span><span class="o">/</span><span class="n">myOverview</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">myOverview</span><span class="o">.</span><span class="n">displayVelForDate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axInset</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">colorBar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axInset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">myVelSeries</span><span class="o">.</span><span class="n">outline</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">axInset</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># Loop over each glacier and plot the flowlines</span>
<span class="k">for</span> <span class="n">glacierId</span> <span class="ow">in</span> <span class="n">myFlowlines</span><span class="p">:</span>
    <span class="c1"># Plot the flowline Match units to the map</span>
    <span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">plotFlowlineLocations</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">colorDict</span><span class="o">=</span><span class="n">flowlineColors</span><span class="p">)</span>
    <span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">plotFlowlineLocations</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">colorDict</span><span class="o">=</span><span class="n">flowlineColors</span><span class="p">)</span>
    <span class="c1"># </span>
    <span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">plotGlacierName</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">plotGlacierName</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Generates points 10km from downstream end of each flowline</span>
    <span class="n">points10km</span> <span class="o">=</span> <span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">extractPoints</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
    <span class="n">glacierPoints</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span> <span class="o">=</span> <span class="n">points10km</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">points10km</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">points10km</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">points10km</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>


<span class="c1"># Add legend</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="c1"># Create a dict of unique labels for legend</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span> <span class="c1"># will overwrite identical entries to produce unique values</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Flowline ID&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="c1">#fig.tight_layout()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interpolation">
<h2>Interpolation<a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h2>
<p>A common function with the velocity date is interpolating data for plotting points or profiles, which can be easily done with the <code class="docutils literal notranslate"><span class="pre">nisarVelSeries.interp</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using km</span>
<span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="o">*</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">xykm</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">vx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">vy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="c1"># or units of meters</span>
<span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="o">*</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">xym</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">vx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">vy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="c1"># or entirely different coordinate system</span>
<span class="n">xytoll</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="mi">3413</span><span class="p">,</span> <span class="mi">4326</span><span class="p">)</span>
<span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">xytoll</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="o">*</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">xym</span><span class="p">())</span>
<span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">sourceEPSG</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">vx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">vy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="c1"># Or would prefer an xarray rather than nparray</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="o">*</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">xykm</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">returnXR</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-central-flowlines-at-different-times">
<h2>Plot Central Flowlines at Different Times<a class="headerlink" href="#plot-central-flowlines-at-different-times" title="Permalink to this headline">¶</a></h2>
<p>This example will demonstrate plotting the nominally central flowline (‘06’) for each of the six years for which there are currently data. This example works for annual data. Minor modifications are needed for the legend if more frequent data are selected above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowlineId</span> <span class="o">=</span><span class="s1">&#39;06&#39;</span>  <span class="c1"># Flowline id to plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>  <span class="c1"># Setup plot</span>
<span class="c1"># Loop over glaciers</span>
<span class="k">for</span> <span class="n">glacierId</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="c1"># return interpolated values as vx(time index, distance index)</span>
    <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="o">*</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">xykm</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
    <span class="c1"># loop over each profile by time</span>
    <span class="k">for</span> <span class="n">speed</span><span class="p">,</span> <span class="n">myDate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">distancekm</span><span class="p">(),</span> <span class="n">speed</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">myDate</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="c1"># pretty up plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (km)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Speed (m/yr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Glacier </span><span class="si">{</span><span class="n">glacierId</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># For other combinations could have </span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-points-through-time">
<h2>Plot Points Through Time<a class="headerlink" href="#plot-points-through-time" title="Permalink to this headline">¶</a></h2>
<p>When the map plots were generated above, a set of points 10-k from the start of each flowline was extracted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glacierPoints</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="c1"># Loop over glaciers</span>
<span class="k">for</span> <span class="n">glacierId</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">glacierPoints</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="c1"># Loop over flowlines</span>
    <span class="k">for</span> <span class="n">flowlineId</span> <span class="ow">in</span> <span class="n">glacierPoints</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]:</span>
        <span class="c1"># interpolate to get results vx(time index) for each point</span>
        <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="o">*</span><span class="n">glacierPoints</span><span class="p">[</span><span class="n">glacierId</span><span class="p">][</span><span class="n">flowlineId</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">myVelSeries</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">flowlineColors</span><span class="p">[</span><span class="n">flowlineId</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flowlineId</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># pretty up plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Flowline ID&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Speed (m/yr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Glacier </span><span class="si">{</span><span class="n">glacierId</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-the-data">
<h2>Save the Data<a class="headerlink" href="#save-the-data" title="Permalink to this headline">¶</a></h2>
<p>While it is convenient to work the date remotely, its nice to be be able to save the data for further processing.</p>
<p>The downloaded subset can be saved in a netcdf and reloaded for to <code class="docutils literal notranslate"><span class="pre">velSeries</span></code> instance for later analysis.</p>
<p>Note makes sure the data have been subsetted so only the the subset will be saved (~15MB in this example). If not, the entire Greeland data set will be saved (370GB).</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">saveData</span></code> and <code class="docutils literal notranslate"><span class="pre">reloadData</span></code> below to test this capability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">saveData</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Set to True to save data</span>
<span class="k">if</span> <span class="n">saveData</span><span class="p">:</span>
    <span class="n">myVelSeries</span><span class="o">.</span><span class="n">toNetCDF</span><span class="p">(</span><span class="s1">&#39;Glaciers1-2example.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now open open the file and redo a plot from above with the saved data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reloadData</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Set to True to reload the saved data</span>
<span class="k">if</span> <span class="n">reloadData</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>  <span class="c1"># Setup plot</span>
    <span class="n">myVelCDF</span> <span class="o">=</span> <span class="n">nisar</span><span class="o">.</span><span class="n">nisarVelSeries</span><span class="p">()</span> <span class="c1"># Create Series</span>
    <span class="n">myVelCDF</span><span class="o">.</span><span class="n">readSeriesFromNetCDF</span><span class="p">(</span><span class="s1">&#39;Glaciers1-2example.nc&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">glacierId</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="c1"># return interpolated values as vx(time index, distance index)</span>
        <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="n">myVelCDF</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="o">*</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">xykm</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="c1"># loop over each profile by time</span>
        <span class="k">for</span> <span class="n">speed</span><span class="p">,</span> <span class="n">myDate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">myVelSeries</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">myFlowlines</span><span class="p">[</span><span class="n">glacierId</span><span class="p">]</span><span class="o">.</span><span class="n">distancekm</span><span class="p">(),</span> <span class="n">speed</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">myDate</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="c1"># pretty up plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (km)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Speed (m/yr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Glacier </span><span class="si">{</span><span class="n">glacierId</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># For other combinations could have </span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="visualizing-with-widgets">
<h1>Visualizing with widgets<a class="headerlink" href="#visualizing-with-widgets" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dotson - requires a shapefile to plot that has been formatted to lists of lat/lon pairs</span>
<span class="c1"># formatting for shapefile: Wcoords2 = [[Wlat2[i],Wlon2[i]] for i in range(Wlat2.shape[0])]</span>

<span class="n">add</span>

<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">74.23</span><span class="p">,</span> <span class="o">-</span><span class="mf">112.00</span><span class="p">]</span>
<span class="n">zoom</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">mapdt1</span> <span class="o">=</span> <span class="s1">&#39;2022-02-01&#39;</span>

<span class="k">global</span> <span class="n">dc</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">lon_l</span><span class="p">,</span> <span class="n">lat_l</span><span class="p">,</span> <span class="n">lon_r</span><span class="p">,</span> <span class="n">lat_r</span><span class="p">,</span> <span class="n">dt</span>

<span class="c1"># Pick date</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DatePicker</span><span class="p">(</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DatePicker</span><span class="p">(</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># dt = widgets.DatePicker(disabled=False)</span>

<span class="c1"># Select from map</span>
<span class="n">draw_control</span> <span class="o">=</span> <span class="n">DrawControl</span><span class="p">(</span><span class="n">rectangle</span><span class="o">=</span><span class="p">{},</span> <span class="n">polyline</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shapeOptions&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#fca45d&#39;</span><span class="p">,</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}},</span> 
                 <span class="n">polygon</span><span class="o">=</span><span class="p">{},</span> <span class="n">circlemarker</span><span class="o">=</span><span class="p">{})</span>

<span class="n">feature_collection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;FeatureCollection&#39;</span><span class="p">,</span>
    <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="k">def</span> <span class="nf">handle_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">geo_json</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do something with the GeoJSON when it&#39;s drawn on the map&quot;&quot;&quot;</span>    
    <span class="n">feature_collection</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo_json</span><span class="p">)</span>

<span class="n">draw_control</span><span class="o">.</span><span class="n">on_draw</span><span class="p">(</span><span class="n">handle_draw</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">basemap</span><span class="o">=</span><span class="n">basemap_to_tiles</span><span class="p">(</span><span class="n">basemaps</span><span class="o">.</span><span class="n">NASAGIBS</span><span class="o">.</span><span class="n">ModisAquaTrueColorCR</span><span class="p">,</span> <span class="n">mapdt1</span><span class="p">),</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>

<span class="n">line1</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="n">Wcoords1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span> <span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">line2</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="n">Wcoords2</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span> <span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>

<span class="c1"># Provides drawing control - can add something that keeps what is drawn...</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">draw_control</span><span class="p">)</span>

<span class="c1"># Can upload a shapefile</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">accept</span><span class="o">=</span><span class="s1">&#39;.shp&#39;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Specify a bounding box</span>
<span class="n">lon_l</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">)</span>
<span class="n">lat_l</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">)</span>
<span class="n">lon_r</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">)</span>
<span class="n">lat_r</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">)</span>

<span class="n">AppLayout</span><span class="p">(</span><span class="n">header</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">([</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;h1&gt;Select area (time and space)&lt;/h1&gt;&quot;</span><span class="p">),</span>
                 <span class="n">HBox</span><span class="p">([</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Start Date:&quot;</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> 
                       <span class="n">Label</span><span class="p">(</span><span class="s2">&quot;End Date:&quot;</span><span class="p">),</span> <span class="n">end</span><span class="p">]),</span>
                 <span class="c1"># HBox([Label(&quot;Map Date:&quot;), mapdt1])</span>
                        <span class="p">]),</span>
             <span class="n">center</span> <span class="o">=</span> <span class="n">m</span><span class="p">,)</span>
</pre></div>
</div>
</div>
</div>
<p>We are now going to revisit ATM and ICESat-2 one last time. We have conducted a bias assessment between the two lidars, so now we are going to look at how the land ice heights change over time.</p>
<p>First let’s take a look at ATM data from previous years. The CSV file we are going to use is pre-processed L2 data for 2011-2018, much like the data from 2019. These flights are slightly east of the 2019 flight, which was adjusted to better align with ICESat-2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in the ATM CSV file</span>
<span class="n">atm_2011_2018</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ILATM2_2011_2019_v3.csv&#39;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> widget
<span class="c1"># Loop through the valid years and plot surface height</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2011&#39;</span><span class="p">,</span> <span class="s1">&#39;2013&#39;</span><span class="p">,</span> <span class="s1">&#39;2014&#39;</span><span class="p">,</span> <span class="s1">&#39;2015&#39;</span><span class="p">,</span> <span class="s1">&#39;2016&#39;</span><span class="p">,</span> <span class="s1">&#39;2018&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span>
    <span class="n">elev</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;elev_&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;elevation [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>It’s obvious that there was significant ice loss between 2011 and 2013. The other years appear to be much more variable - let’s focus in on the trough at 69.203N…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the latitude bounds of the surface trough</span>
<span class="n">lat_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">69.1982</span><span class="p">,</span> <span class="mf">69.2113</span><span class="p">]</span>

<span class="c1"># 2013 has the longest streak of data over this region. We are going to downscale the other years to its length.</span>
<span class="n">lat_2013</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_2013&#39;</span><span class="p">][(</span><span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_2013&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_2013&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="c1"># First, downscale the 2011 data to 2013 resolution</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_2011&#39;</span><span class="p">]</span>
<span class="n">elev</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;elev_2011&#39;</span><span class="p">][(</span><span class="n">lat</span><span class="o">&gt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span><span class="o">&lt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
<span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span><span class="o">&gt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span><span class="o">&lt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">spl</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">lat</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">elev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">slp_2011</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">lat_2013</span><span class="p">,</span> <span class="n">spl</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calculate ice loss relative to 2011</span>
<span class="n">delta_h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">std_h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span> <span class="c1"># Start loop at 2013 (2012 has no data)</span>
    <span class="k">if</span> <span class="n">year</span> <span class="o">!=</span> <span class="mi">2013</span><span class="p">:</span> <span class="c1"># Downscale other years to 2013 resolution</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span>
        <span class="n">elev</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;elev_&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">][(</span><span class="n">lat</span><span class="o">&gt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span><span class="o">&lt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Downscale the data with splines</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span><span class="o">&gt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span><span class="o">&lt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">lat</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">elev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">spl_year</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">lat_2013</span><span class="p">,</span> <span class="n">spl</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Now calculate the difference relative to 2011</span>
        <span class="n">delta_h</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spl_year</span> <span class="o">-</span> <span class="n">slp_2011</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">std_h</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spl_year</span> <span class="o">-</span> <span class="n">slp_2011</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;Latitude_&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span>
        <span class="n">elev</span> <span class="o">=</span> <span class="n">atm_2011_2018</span><span class="p">[</span><span class="s1">&#39;elev_&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">][(</span><span class="n">lat</span><span class="o">&gt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span><span class="o">&lt;</span><span class="n">lat_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Calculate the difference relative to 2011</span>
        <span class="n">delta_h</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">slp_2011</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">std_h</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spl_year</span> <span class="o">-</span> <span class="n">slp_2011</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    
<span class="o">%</span><span class="k">matplotlib</span> widget
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">delta_h</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std_h</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\Delta$ h [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Ta-da!! Using a few operations, we were able to use ATM data to derive a rough time series of ice sheet elevation change over Jakobshavan.</p>
<p>We’re going to try and do the same thing, but for ICESat-2. Because it was launched in late-2018, we are going to try and grab interseasonal measurements from RGT 338 for 2019-2021.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time to go through the icepyx routine again!</span>
<span class="kn">import</span> <span class="nn">icepyx</span> <span class="k">as</span> <span class="nn">ipx</span>

<span class="c1"># Specifying the necessary icepyx parameters</span>
<span class="n">short_name</span> <span class="o">=</span> <span class="s1">&#39;ATL06&#39;</span>
<span class="n">lat_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">69.1982</span><span class="p">,</span> <span class="mf">69.2113</span><span class="p">]</span>
<span class="n">spatial_extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mf">69.1982</span><span class="p">,</span> <span class="o">-</span><span class="mf">48.5</span><span class="p">,</span> <span class="mf">69.2113</span><span class="p">]</span> <span class="c1"># KML polygon centered on Jakobshavan</span>
<span class="n">date_range</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2019-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-12-30&#39;</span><span class="p">]</span>
<span class="n">rgts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;338&#39;</span><span class="p">]</span> <span class="c1"># IS-2 RGT of interest</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the Query object</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">ipx</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">short_name</span><span class="p">,</span> <span class="n">spatial_extent</span><span class="p">,</span> <span class="n">date_range</span><span class="p">,</span> <span class="n">tracks</span><span class="o">=</span><span class="n">rgts</span><span class="p">)</span>

<span class="c1"># Show the available granules</span>
<span class="n">region</span><span class="o">.</span><span class="n">avail_granules</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Earthdata credentials</span>
<span class="n">uid</span> <span class="o">=</span> <span class="s1">&#39;zhfair&#39;</span>
<span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;zhfair@umich.edu&#39;</span>
<span class="n">region</span><span class="o">.</span><span class="n">earthdata_login</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

<span class="c1"># Order the granules</span>
<span class="n">region</span><span class="o">.</span><span class="n">order_granules</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/home/jovyan/website2022/book/tutorials/DataIntegration/&#39;</span>
<span class="n">region</span><span class="o">.</span><span class="n">download_granules</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>

<span class="o">%</span><span class="k">matplotlib</span> widget

<span class="c1"># Iterate through the files to grab elevation, and derive elevation differences relative to April 2019</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;processed_&#39;</span> <span class="o">+</span> <span class="n">granule</span> <span class="k">for</span> <span class="n">granule</span> <span class="ow">in</span> <span class="n">region</span><span class="o">.</span><span class="n">avail_granules</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Get the initial data from April 2019</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">elev_42019</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/h_li&#39;</span><span class="p">][:]</span>
    <span class="n">lat_42019</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/latitude&#39;</span><span class="p">][:]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat_42019</span><span class="p">,</span> <span class="n">elev_42019</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">16</span><span class="p">:</span><span class="mi">24</span><span class="p">])</span>

<span class="n">delta_h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">std_h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cloud_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/geophysical/cloud_flg_asr&#39;</span><span class="p">][:])</span>
            <span class="c1"># Filter out cloudy scenes</span>
            <span class="k">if</span> <span class="n">cloud_flag</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/latitude&#39;</span><span class="p">][:]</span>
                <span class="n">elev</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/h_li&#39;</span><span class="p">][:]</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="c1"># Get date of IS-2 overpass</span>
                
                <span class="c1"># Find the difference relative to April 2019</span>
                <span class="n">delta_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">elev</span> <span class="o">-</span> <span class="n">elev_42019</span><span class="p">))</span>
                <span class="n">std_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">elev</span> <span class="o">-</span> <span class="n">elev_42019</span><span class="p">))</span>
                
                <span class="c1"># Plot the elevation data</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no data&#39;</span><span class="p">)</span>
            
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;elevation [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the ice sheet change time series</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;20190420&#39;</span><span class="p">,</span><span class="s1">&#39;20200117&#39;</span><span class="p">,</span> <span class="s1">&#39;20200717&#39;</span><span class="p">,</span> <span class="s1">&#39;202110115&#39;</span><span class="p">]</span>
<span class="o">%</span><span class="k">matplotlib</span> widget
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">delta_h</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std_h</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\Delta$ h [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>There we go! We lost some data due to cloud cover, and the mean change has some spread, but the ICESat-2 data continues to show a downward trend that was suggested by ATM.</p>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>🎉 Congratulations! You’ve completely this tutorial and have seen how we can add  notebook can be formatted, and how to create interactive map visualization with ipyleaflet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have noticed Jupyter Book adds some extra formatting features that do not necessarily render as you might expect when <em>executing</em> a noteook in Jupyter Lab. This “admonition” note is one such example.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Jupyter Book is very particular about <a class="reference external" href="https://jupyterbook.org/structure/sections-headers.html?highlight=headers#how-headers-and-sections-map-onto-to-book-structure">Markdown header ordering</a> to automatically create table of contents on the website. In this tutorial we are careful to use a single main header (#) and sequential subheaders (#, ##, ###, etc.)</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>To further explore the topics of this tutorial see the following detailed documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jupyterbook.org/file-types/notebooks.html">Jupyter Book rendering of .ipynb notebooks</a></p></li>
<li><p><a class="reference external" href="https://jupyterbook.org/content/index.html">Jupyter Book guide on writing narrative content</a></p></li>
<li><p><a class="reference external" href="https://ipyleaflet.readthedocs.io">ipyleaflet documentation</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/DataIntegration"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="dataintegration-1.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data integration with ICESat-2 - Part I</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../projects/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Projects</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By eScience Institute, University of Washington<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>