
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data integration with ICESat-2 - Part I &#8212; ICESat-2 Hackweek 2022</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Data integration with ICESat-2 - Part II" href="dataintegration-2.html" />
    <link rel="prev" title="OpenAltimery and GEE Use Examples" href="../DataVisualization/Visualization_geemap_use_examples.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LZVEY6377Z"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-LZVEY6377Z');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ICESat-2 Hackweek 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to ICESat-2 Hackweek!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Details
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../application.html">
   Application
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=schedule">
   Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=team">
   Team
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../mission.html">
   Hackweek Mission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../CoC.html">
   Event Code of Conduct
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preparation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../preliminary/index.html">
   Preliminary Work
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/swc.html">
     Software Carpentry Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/github.html">
     GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/jupyterhub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/git.html">
     Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthdata.html">
     Earthdata Login
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthengine.html">
     Google Earth Engine Sign-Up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/python.html">
     Python Installation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter.html">
     GitHub, Git, JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataProducts/DataProducts.html">
     ICESat-2 data products
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../data_access/data_access_1_intro.html">
     ICESat-2 Data Discovery, Visualization, and Access Resources
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_access/data_access_2_earthdata.html">
       Data Discovery and Access via
       <strong>
        earthdata
       </strong>
       library
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_access/data_access_3_icepyx.html">
       Accessing ICESat-2 Data Using icepyx
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../geospatial/geospatial-intro.html">
     Geospatial Transforms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../geospatial/geospatial-advanced.html">
       Geospatial Transformations In-depth
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html">
     Interactive Visualizion with Open Altimetry &amp; Google Earth Engine
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../DataVisualization/Visualization_geemap_use_examples.html">
       OpenAltimery and GEE Use Examples
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="current reference internal" href="#">
     Data integration with ICESat-2 - Part I
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="dataintegration-2.html">
       Data integration with ICESat-2 - Part II
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="data-applications.html">
       ICESat-2 Applications: GrIMP + SlideRule
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud-computing/cloud-computing-tutorial.html">
     Cloud Computing Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataVisualization/dataviz2d.html">
     <strong>
      Making nice maps for posters with Python
     </strong>
     üó∫Ô∏è+üêç
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../projects/index.html">
   Projects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roles.html">
     Project Roles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roadmap.html">
     Project Roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_initialization.html">
     Project Initialization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/list_of_projects.html">
     List of Projects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/glossary.html">
   Glossaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/IS2-resources.html">
   ICESat-2 Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_source_software.html">
   Open-source Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/questions.html">
   How to Get Help
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tutorials/DataIntegration/dataintegration-1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ICESAT-2HackWeek/website2022"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ICESAT-2HackWeek/website2022/issues/new?title=Issue%20on%20page%20%2Ftutorials/DataIntegration/dataintegration-1.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ICESAT-2HackWeek/website2022/edit/main/book/tutorials/DataIntegration/dataintegration-1.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ICESAT-2HackWeek/website2022/main?urlpath=lab/tree/book/tutorials/DataIntegration/dataintegration-1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-environment">
   Computing environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-and-acquire-the-icesat2-product-s-of-interest">
   1. Identify and acquire the ICESat2 product(s) of interest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-icesat-2-atl06-data-from-desired-region">
     Download ICESat-2 ATL06 data from desired region
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-other-products-of-interest">
   2. Identify other products of interest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-respond-in-slack">
     Question - Respond in Slack
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#where-are-other-data-sets-stored">
     Where are other data sets stored?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acquire-non-cloud-data-and-open-atm-data-access">
   3. Acquire non-cloud data and open:  ATM data access
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#opening-and-manipulating-data-in-pandas">
     Opening and manipulating data in Pandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#slicing">
       Slicing
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statistical-manipulations">
       Statistical manipulations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   Exercise
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multi-indexing">
     Multi-indexing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#co-register-icesat-2-with-atm-data">
     Co-register ICESat-2 with ATM data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search-and-open-landsat-raster-imagery-from-the-cloud">
   3.  Search and open (Landsat) raster imagery from the cloud
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cloud-optimized-approaches">
     Cloud optimized approaches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-for-landsat-imagery">
     Search for Landsat imagery
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intake-all-scenes-using-the-intake-stac-library">
     Intake all scenes using the intake-STAC library
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-and-visualize-each-image-using-rasterio">
     Open and visualize each image using RasterIO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-data-in-xarray">
     Manipulating data in Xarray
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rasterio-and-rioxarray">
       RasterIO and RioXarray
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dask">
       Dask
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advanced-multi-dimensional-read-ins-manipulation-and-visualization">
     Advanced multi-dimensional read-ins, manipulation and visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   4. Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data integration with ICESat-2 - Part I</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-environment">
   Computing environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-and-acquire-the-icesat2-product-s-of-interest">
   1. Identify and acquire the ICESat2 product(s) of interest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-icesat-2-atl06-data-from-desired-region">
     Download ICESat-2 ATL06 data from desired region
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-other-products-of-interest">
   2. Identify other products of interest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-respond-in-slack">
     Question - Respond in Slack
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#where-are-other-data-sets-stored">
     Where are other data sets stored?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acquire-non-cloud-data-and-open-atm-data-access">
   3. Acquire non-cloud data and open:  ATM data access
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#opening-and-manipulating-data-in-pandas">
     Opening and manipulating data in Pandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#slicing">
       Slicing
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statistical-manipulations">
       Statistical manipulations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   Exercise
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multi-indexing">
     Multi-indexing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#co-register-icesat-2-with-atm-data">
     Co-register ICESat-2 with ATM data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search-and-open-landsat-raster-imagery-from-the-cloud">
   3.  Search and open (Landsat) raster imagery from the cloud
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cloud-optimized-approaches">
     Cloud optimized approaches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-for-landsat-imagery">
     Search for Landsat imagery
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intake-all-scenes-using-the-intake-stac-library">
     Intake all scenes using the intake-STAC library
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-and-visualize-each-image-using-rasterio">
     Open and visualize each image using RasterIO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-data-in-xarray">
     Manipulating data in Xarray
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rasterio-and-rioxarray">
       RasterIO and RioXarray
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dask">
       Dask
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advanced-multi-dimensional-read-ins-manipulation-and-visualization">
     Advanced multi-dimensional read-ins, manipulation and visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   4. Summary
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="data-integration-with-icesat-2-part-i">
<h1>Data integration with ICESat-2 - Part I<a class="headerlink" href="#data-integration-with-icesat-2-part-i" title="Permalink to this headline">¬∂</a></h1>
<p><strong>Credits</strong></p>
<ul class="simple">
<li><p>Zach Fair</p></li>
<li><p>Ian Joughin</p></li>
<li><p>Tasha Snow</p></li>
</ul>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning Objectives</p>
<p><strong>Goals</strong></p>
<ul class="simple">
<li><p>Identify and locate non-ICESat-2 data sets</p></li>
<li><p>Acquire data from the cloud or via download</p></li>
<li><p>Open data in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">xarray</span></code> and basic functioning of DataFrames</p></li>
</ul>
</div>
<div class="admonition-key-takeaway admonition">
<p class="admonition-title">Key Takeaway</p>
<p>By the end of this tutorial, you will be able to visualize Cloud Optimized Geotiffs with ICESat-2 and ATM data.</p>
</div>
<p>For this tutorial, feel free to run the code along with us as we live code by downsizing the zoom window and splitting your screen (or using two screens). Or you can simply watch the zoom walkthrough. Don‚Äôt worry if you fall behind on the code. The notebook is standalone and you can easily run the code at your own pace another time to catch anything you missed.</p>
<p>We will have one exercise you can type into a notebook, or figure out in a separate document. We will also ask some questions that you can responsd to in the tutorial Slack channel.</p>
<div class="section" id="computing-environment">
<h2>Computing environment<a class="headerlink" href="#computing-environment" title="Permalink to this headline">¬∂</a></h2>
<p>We‚Äôll be using the following open source Python libraries in this notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipyleaflet</span>
<span class="kn">from</span> <span class="nn">ipyleaflet</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">GeoData</span><span class="p">,</span> <span class="n">LayersControl</span><span class="p">,</span><span class="n">Rectangle</span><span class="p">,</span> <span class="n">basemaps</span><span class="p">,</span> <span class="n">basemap_to_tiles</span><span class="p">,</span> <span class="n">TileLayer</span><span class="p">,</span> <span class="n">SplitMapControl</span><span class="p">,</span> <span class="n">Polygon</span>

<span class="kn">import</span> <span class="nn">ipywidgets</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %matplotlib widget</span>
<span class="kn">import</span> <span class="nn">satsearch</span>
<span class="kn">from</span> <span class="nn">satsearch</span> <span class="kn">import</span> <span class="n">Search</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geoviews</span> <span class="k">as</span> <span class="nn">gv</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">intake</span> <span class="c1"># if you&#39;ve installed intake-STAC, it will automatically import alongside intake</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">from</span> <span class="nn">rasterio.session</span> <span class="kn">import</span> <span class="n">AWSSession</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">import</span> <span class="nn">rioxarray</span> <span class="k">as</span> <span class="nn">rxr</span>
<span class="kn">from</span> <span class="nn">dask.utils</span> <span class="kn">import</span> <span class="n">SerializableLock</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hvplot.xarray</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Proj</span><span class="p">,</span> <span class="n">transform</span>

<span class="c1"># Suppress library deprecation warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="identify-and-acquire-the-icesat2-product-s-of-interest">
<h2>1. Identify and acquire the ICESat2 product(s) of interest<a class="headerlink" href="#identify-and-acquire-the-icesat2-product-s-of-interest" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>What is the application of this product?</p></li>
<li><p>What region and resolution is needed?</p></li>
</ul>
<div class="section" id="download-icesat-2-atl06-data-from-desired-region">
<h3>Download ICESat-2 ATL06 data from desired region<a class="headerlink" href="#download-icesat-2-atl06-data-from-desired-region" title="Permalink to this headline">¬∂</a></h3>
<p>Remember icepyx? We are going to use that again to download some ICESat-2 ATL06 data over our region of interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">icepyx</span> <span class="k">as</span> <span class="nn">ipx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specifying the necessary icepyx parameters</span>
<span class="n">short_name</span> <span class="o">=</span> <span class="s1">&#39;ATL06&#39;</span>
<span class="n">spatial_extent</span> <span class="o">=</span> <span class="s1">&#39;hackweek_kml_jakobshavan.kml&#39;</span> <span class="c1"># KML polygon centered on Jakobshavan</span>
<span class="n">date_range</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2019-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-04-30&#39;</span><span class="p">]</span>
<span class="n">rgts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;338&#39;</span><span class="p">]</span> <span class="c1"># IS-2 RGT of interest</span>
</pre></div>
</div>
</div>
</div>
<p>You may notice that we specified a RGT track. As seen below, a large number of ICESat-2 overpasses occur for Jakobshavan. In the interest of time (and computer memory), we are going to look at only one of these tracks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show image of area of interest (data viz tutorial will get in deeper so don&#39;t explain much):</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">69.2</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">]</span>
<span class="n">zoom</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># Open KML file for visualizing</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">fiona</span><span class="o">.</span><span class="n">drvsupport</span><span class="o">.</span><span class="n">supported_drivers</span><span class="p">[</span><span class="s1">&#39;KML&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rw&#39;</span>
<span class="n">jk</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">spatial_extent</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;KML&#39;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">basemap</span><span class="o">=</span><span class="n">basemap_to_tiles</span><span class="p">(</span><span class="n">basemaps</span><span class="o">.</span><span class="n">NASAGIBS</span><span class="o">.</span><span class="n">ModisAquaTrueColorCR</span><span class="p">,</span> <span class="s1">&#39;2020-07-18&#39;</span><span class="p">),</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
<span class="n">geo_data</span> <span class="o">=</span> <span class="n">GeoData</span><span class="p">(</span><span class="n">geo_dataframe</span> <span class="o">=</span> <span class="n">jk</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">geo_data</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">LayersControl</span><span class="p">())</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the Query object</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">ipx</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">short_name</span><span class="p">,</span> <span class="n">spatial_extent</span><span class="p">,</span> <span class="n">date_range</span><span class="p">,</span> <span class="n">tracks</span><span class="o">=</span><span class="n">rgts</span><span class="p">)</span>

<span class="c1"># Show the available granules</span>
<span class="n">region</span><span class="o">.</span><span class="n">avail_granules</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like we have an ICESat-2 track! Let‚Äôs quickly visualize the data to ensure that there are no clouds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Request information from OpenAltimetry</span>
<span class="n">cyclemap</span><span class="p">,</span> <span class="n">rgtmap</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">visualize_elevation</span><span class="p">()</span>

<span class="n">rgtmap</span>
</pre></div>
</div>
</div>
</div>
<p>Looks good! Now it‚Äôs time to download the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Earthdata credentials</span>
<span class="n">uid</span> <span class="o">=</span> <span class="s1">&#39;uwhackweek&#39;</span>
<span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;hackweekadmin@gmail.com&#39;</span>
<span class="n">region</span><span class="o">.</span><span class="n">earthdata_login</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

<span class="c1"># Order the granules</span>
<span class="n">region</span><span class="o">.</span><span class="n">order_granules</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the data</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/home/jovyan/website2022/book/tutorials/DataIntegration/&#39;</span>
<span class="n">region</span><span class="o">.</span><span class="n">download_granules</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># Load the ICESat-2 data. We will just look at the central beams (GT2R/L)</span>
<span class="n">is2_file</span> <span class="o">=</span> <span class="s1">&#39;processed_ATL06_20190420093051_03380303_005_01_full.h5&#39;</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">is2_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">is2_gt2r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/latitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/longitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/h_li&#39;</span><span class="p">][:]})</span>
    <span class="n">is2_gt2l</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/latitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/longitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/h_li&#39;</span><span class="p">][:]})</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="identify-other-products-of-interest">
<h2>2. Identify other products of interest<a class="headerlink" href="#identify-other-products-of-interest" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="question-respond-in-slack">
<h3>Question - Respond in Slack<a class="headerlink" href="#question-respond-in-slack" title="Permalink to this headline">¬∂</a></h3>
<p>What research problems have you wanted to address that require more than one dataset?</p>
</div>
<div class="section" id="where-are-other-data-sets-stored">
<h3>Where are other data sets stored?<a class="headerlink" href="#where-are-other-data-sets-stored" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Cloud datasets in AWS
<a class="reference external" href="https://registry.opendata.aws/">https://registry.opendata.aws/</a></p></li>
<li><p>NASA EarthData
<a class="reference external" href="https://search.earthdata.nasa.gov/search/">https://search.earthdata.nasa.gov/search/</a></p></li>
<li><p>ESA Copernicus Hub
<a class="reference external" href="https://scihub.copernicus.eu">https://scihub.copernicus.eu</a></p></li>
<li><p>Etc.</p></li>
</ul>
<p>More on this in the Cloud Computing Tools tutorial</p>
<p>Today, we will show ATM (non-AWS) and Landsat (AWS)</p>
</div>
</div>
<div class="section" id="acquire-non-cloud-data-and-open-atm-data-access">
<h2>3. Acquire non-cloud data and open:  ATM data access<a class="headerlink" href="#acquire-non-cloud-data-and-open-atm-data-access" title="Permalink to this headline">¬∂</a></h2>
<p>Why did we choose April 2019 and RGT 338? In Spring 2019, an airborne campaign called Operation IceBridge was flown across Jakobshavan as validation for ICESat-2. Onboard was the Airborne Topographic Mapper, a lidar that works at both 532 nm (like ICESat-2) and 1064 nm (near-infrared). More information about Operation IceBridge and ATM may be found here: <a class="reference external" href="https://nsidc.org/data/icebridge">https://nsidc.org/data/icebridge</a></p>
<p>Here, we are going to try and co-register ATM spot measurements with ICESat-2. Because both data sets are rather large, this can be computationally expensive, so we will only consider one flight track with the ATM 532 nm beam.</p>
<p>Operation IceBridge data is not available on the cloud, so this data was downloaded directly from NSIDC. If you are interested in using IceBridge data, NSIDC has a useful data portal here: <a class="reference external" href="https://nsidc.org/icebridge/portal/map">https://nsidc.org/icebridge/portal/map</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the ATM data into a DataFrame</span>
<span class="n">atm_file</span> <span class="o">=</span> <span class="s1">&#39;ILATM2_20190506_151600_smooth_nadir3seg_50pt.csv&#39;</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atm_file</span><span class="p">)</span>

<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We opened this data into a Pandas DataFrame, which is a handy tool for Earth data exploration and analysis. The column names derive automatically from the first row of the csv and each row corresponds to an ATM measurement.</p>
<div class="section" id="opening-and-manipulating-data-in-pandas">
<h3>Opening and manipulating data in Pandas<a class="headerlink" href="#opening-and-manipulating-data-in-pandas" title="Permalink to this headline">¬∂</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code> excels at helping you explore, clean, and process tabular data, such as data stored in spreadsheets or databases. In <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, a Series is a 1-D data table and a DataFrame is the 2-D data table, which we just saw above.</p>
<p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, the function we used above, is the easiest way to open a csv data file into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame. We can specify formatting, data selection, indexing, and much more when reading any data into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame. Below we read in the data again, specifying different headers, assigning the first column as the index, and assigning the first column as the header (even though we are renaming it, so that it doesn‚Äôt mistake the first row in the csv as data).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data with specific headers</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Height&#39;</span><span class="p">,</span> <span class="s1">&#39;South-to-North_Slope&#39;</span><span class="p">,</span>
       <span class="s1">&#39;West-to-East_Slope&#39;</span><span class="p">,</span> <span class="s1">&#39;RMS_Fit&#39;</span><span class="p">,</span> <span class="s1">&#39;Number_Measurements&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Number_Measurements_Removed&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Distance_Of_Block_To_The_Right_Of_Aircraft&#39;</span><span class="p">,</span> <span class="s1">&#39;Track_Identifier&#39;</span><span class="p">]</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atm_file</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can explore the data and DataFrame functions‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find out the names of the columns</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show data in only one of those columns</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Same thing, but another way</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">Lat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If we want something more intuitive for our index, we can create a column of datetime objects that uses the date from the ATM file name and seconds_of_day column as date and time information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset the index</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Use the date in the string of the file name to create a datetime of the date</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">atm_file</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>

<span class="c1"># Use UTC seconds_of_day column to calculate time of day that we will use to add time to the datetime</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">atm_l2</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>

<span class="c1"># Add the time to date and set as index</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;DateTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">time</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;DateTime&#39;</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can easily slice data by date, month, day, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;2019-05-06&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Or by a range of dates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;2019-05-06&#39;</span><span class="p">:</span><span class="s1">&#39;2019-05-07&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="slicing">
<h4>Slicing<a class="headerlink" href="#slicing" title="Permalink to this headline">¬∂</a></h4>
<p>Two methods for slicing:</p>
<ul class="simple">
<li><p>.loc for label-based indexing</p></li>
<li><p>.iloc for positional indexing</p></li>
</ul>
<p>Use loc to slice specific indices</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Select indices and columns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Height&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Use iloc to select by row and column number</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="statistical-manipulations">
<h4>Statistical manipulations<a class="headerlink" href="#statistical-manipulations" title="Permalink to this headline">¬∂</a></h4>
<p>Say we want to know the mean ATM height for the data‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Number_Measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If we want to know the mean of each column grouped for each Track Identifier‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group rows together by a column and take the mean of each group</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Groupby is pretty complex. You can dive deeper here:
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html">https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html</a></p>
<p>You can also resample your data to get the mean of all measurements at 30 second intervals‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;30S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To use your own functions, one might first try to use a for loop to iterate over rows or columns of data. <code class="docutils literal notranslate"><span class="pre">Pandas</span></code> has made an easy and fast alternative, <strong>apply()</strong>. This function acts as a map() function in Python. It takes a function as an input and applies the function to an entire DataFrame.</p>
<p>Something easy could be to take the median of each column of the data. We specify the np.median function and axis=0 to pass in all rows and iterate over each column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Say you want to use only specific rows or columns in your function. For instance, you want to know the total number of measurements (i.e. Number_Measurements + Number_Measurements_Removed). We already have a function that takes two columns and adds them together. Now we want to apply it to the data.</p>
<p>First, we call the <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> method on the <code class="docutils literal notranslate"><span class="pre">atm_l2</span></code> dataframe. Then use the lambda function to iterate over the rows (or columns) of the dataframe. For every row, we grab the <code class="docutils literal notranslate"><span class="pre">Number_Measurements</span></code> and <code class="docutils literal notranslate"><span class="pre">Number_Measurements_Removed</span></code> columns and pass them to the <code class="docutils literal notranslate"><span class="pre">calc_total</span></code> function. Finally, we specify the <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> to tell the <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> method that we are passing in columns to apply the function to each row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_total</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">total</span>

<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Total_Measurements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calc_total</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Number_Measurements&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Number_Measurements_Removed&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¬∂</a></h2>
<p>Try making <code class="docutils literal notranslate"><span class="pre">.apply</span></code> work with this new function to create a new column, <code class="docutils literal notranslate"><span class="pre">Distance_to_Jakobshavn</span></code>, using the <code class="docutils literal notranslate"><span class="pre">Lat</span></code> and <code class="docutils literal notranslate"><span class="pre">Lon</span></code> columns as inputs. We‚Äôve already supplied the function, which requires a latitude and longitude input to calculate the distance between the ATM measurement and a specified point on the Jakobshavn Glacier ice front (<code class="docutils literal notranslate"><span class="pre">jlat</span></code>/<code class="docutils literal notranslate"><span class="pre">jlon</span></code>). Complete the line that applies the function to those columns in the data to get the <code class="docutils literal notranslate"><span class="pre">Distance_to_Jakobshavn</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">radians</span>

<span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate distance between a set point and a lat lon pair from the data</span>
<span class="sd">    a = lat</span>
<span class="sd">    b = lon</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">jlat</span><span class="p">,</span><span class="n">jlon</span> <span class="o">=</span> <span class="mf">69.2330</span><span class="p">,</span> <span class="o">-</span><span class="mf">49.2434</span>
    
    <span class="c1"># approximate radius of earth in km</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">6373.0</span>

    <span class="n">lat1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">jlat</span><span class="p">)</span>
    <span class="n">lon1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">jlon</span><span class="p">)</span>
    <span class="n">lat2</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">lon2</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="n">distance</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">distance</span>

<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Distance_to_Jakobshavn&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="o">.....</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Great work! Now let‚Äôs reset the index to start fresh for multi-indexing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multi-indexing">
<h3>Multi-indexing<a class="headerlink" href="#multi-indexing" title="Permalink to this headline">¬∂</a></h3>
<p>Multi-level indexing opens the door to more sophisticated data analysis and manipulation, especially for working with higher dimensional data. In essence, it enables you to store and manipulate data with an arbitrary number of dimensions in lower dimensional data structures like Series (1d) and DataFrame (2d).</p>
<p>Here, we will demonstrate a few basic things you can do with MultiIndexing. If we wanted to think about our data by DateTime and then by Track Identifier, we would set both columns as indices‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;DateTime&#39;</span><span class="p">,</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">atm_l2</span>
</pre></div>
</div>
</div>
</div>
<p>For some terminology, the <code class="docutils literal notranslate"><span class="pre">levels</span></code> of a MultiIndex are the former column names (UTC, Track_Identifier). The <code class="docutils literal notranslate"><span class="pre">labels</span></code> are the actual values in a <code class="docutils literal notranslate"><span class="pre">level</span></code>, (2019-05-06 15:16:09.500, 0-3, ‚Ä¶). <code class="docutils literal notranslate"><span class="pre">Levels</span></code> can be referred to by name or position, with 0 being the outermost level.</p>
<p>Slicing the outermost index level is pretty easy, we just use our regular <code class="docutils literal notranslate"><span class="pre">.loc[row_indexer,</span> <span class="pre">column_indexer]</span></code> to grab a couple datetimes we want. We‚Äôll select the columns Lat and Lon where the UTC was <code class="docutils literal notranslate"><span class="pre">2019-05-06</span> <span class="pre">15:16:09.500</span></code> and <code class="docutils literal notranslate"><span class="pre">2019-05-06</span> <span class="pre">15:16:09.750</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lon&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>If you wanted to select the rows whose track was <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">.loc</span></code> wants [row_indexer, column_indexer] so let‚Äôs wrap the two elements of our row indexer (the list of UTCs and the Tracks) in a tuple to make it a single unit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lon&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Now you want info from any UTC but for the specific tracks again (0,1). Below the <code class="docutils literal notranslate"><span class="pre">:</span></code> indicates all labels in this level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lon&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>You can do a lot with groupby, pivoting, and reshaping, but I won‚Äôt dive into that in this tutorial. You can check out more here: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html">https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html</a></p>
<p>Now that we are oriented with the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame, let‚Äôs get back to the ATM data we have opened and co-register it with the ICESat-2 lines.</p>
</div>
<div class="section" id="co-register-icesat-2-with-atm-data">
<h3>Co-register ICESat-2 with ATM data<a class="headerlink" href="#co-register-icesat-2-with-atm-data" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the ATM data into a DataFrame</span>
<span class="n">atm_file</span> <span class="o">=</span> <span class="s1">&#39;ILATM2_20190506_151600_smooth_nadir3seg_50pt.csv&#39;</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atm_file</span><span class="p">)</span>

<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The ATM L2 file contains plenty of information, including surface height estimates and slope of the local topography. It also contains a track identifier - ATM takes measurements from multiple parts of the aircraft, namely starboard, port, and nadir. To keep things simple, we will filter the DataFrame to only look at the nadir track (Track_Identifier = 0).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Change the longitudes to be consistent with ICESat-2</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

<span class="nb">print</span><span class="p">(</span><span class="n">atm_l2</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs take a quick look at where ATM is relative to ICESat-2‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset the ICESat-2 data to the ATM latitudes</span>
<span class="n">is2_gt2r</span> <span class="o">=</span> <span class="n">is2_gt2r</span><span class="p">[(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>
<span class="n">is2_gt2l</span> <span class="o">=</span> <span class="n">is2_gt2l</span><span class="p">[(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>


<span class="c1"># Set up a map with the flight tracks as overlays</span>
<span class="kn">from</span> <span class="nn">ipyleaflet</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">basemaps</span><span class="p">,</span> <span class="n">basemap_to_tiles</span><span class="p">,</span> <span class="n">Polyline</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span>
    <span class="n">basemap</span><span class="o">=</span><span class="n">basemap_to_tiles</span><span class="p">(</span><span class="n">basemaps</span><span class="o">.</span><span class="n">Esri</span><span class="o">.</span><span class="n">WorldImagery</span><span class="p">),</span>
    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mf">69.25</span><span class="p">,</span> <span class="mf">310.35</span><span class="o">-</span><span class="mi">360</span><span class="p">),</span>
    <span class="n">zoom</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">gt2r_line</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span>
    <span class="n">locations</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span> <span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">gt2r_line</span><span class="p">)</span>

<span class="n">gt2l_line</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span>
    <span class="n">locations</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span> <span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">gt2l_line</span><span class="p">)</span>

<span class="n">atm_line</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span>
    <span class="n">locations</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span> <span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">atm_line</span><span class="p">)</span>

<span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like ATM aligns very closely with the left beam (GT2L), so hopefully the two beams will agree. The terrain over this region is quite rough, so we may expect some differences between ATM and GT2R. ICESat-2 also flew over Jakobshavan 16 days before ATM, so there might be slight differences due to ice movement.</p>
<p>We have looked at how we can quickly download ICESat-2 and airborne lidar data, and process them using <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. We will engage in a more thorough analysis in the Data Integration session tomorrow.</p>
</div>
</div>
<div class="section" id="search-and-open-landsat-raster-imagery-from-the-cloud">
<h2>3.  Search and open (Landsat) raster imagery from the cloud<a class="headerlink" href="#search-and-open-landsat-raster-imagery-from-the-cloud" title="Permalink to this headline">¬∂</a></h2>
<p>Let‚Äôs now talk about cloud-optimized approaches that require no downloading to search and access the data.</p>
<div class="section" id="cloud-optimized-approaches">
<h3>Cloud optimized approaches<a class="headerlink" href="#cloud-optimized-approaches" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Organize data as an aggregation of small, independently retrievable objects (e.g., zarr, HDF2, Geotiff in the Cloud)</p></li>
<li><p>Allow access to pieces of large objects (e.g., Cloud-Optimized GeoTIFF3, OPeNDAP4 in the Cloud)</p></li>
</ul>
<p>We will be working with Cloud Optimized GeoTIFF (COG). A COG is a GeoTIFF file with an internal organization that enables more efficient workflows by allowing us to ask for just the parts of a file we need, instead of having to open the entire image or data set (see more at <a class="reference external" href="https://www.cogeo.org/">https://www.cogeo.org/</a>).</p>
<p>Example url for accessing a band in the cloud from an S3 bucket:<br />
s3://usgs-landsat/collection02/level-2/standard/oli-tirs/2020/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/LC08_L1TP_202025_20190420_20190507_01_T1_B4.TIF</p>
<p>User Manual for more information about accessing Landsat S3: <br />
<a class="reference external" href="https://d9-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/atoms/files/LSDS-2032-Landsat-Commercial-Cloud-Direct-Access-Users-Guide-v2.pdf.pdf">https://d9-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/atoms/files/LSDS-2032-Landsat-Commercial-Cloud-Direct-Access-Users-Guide-v2.pdf.pdf</a></p>
</div>
<div class="section" id="search-for-landsat-imagery">
<h3>Search for Landsat imagery<a class="headerlink" href="#search-for-landsat-imagery" title="Permalink to this headline">¬∂</a></h3>
<p>To explore and access COG‚Äôs easily we will use a SpatioTemporal Asset Catalog (STAC). The STAC provides a common metadata format to make it easier to index and querrying S3 buckets for geospatial data. Learn more here: <a class="reference external" href="https://github.com/radiantearth/stac-spec">https://github.com/radiantearth/stac-spec</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sets up credentials for acquiring images through dask/xarray</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AWS_REQUEST_PAYER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;requester&quot;</span>

<span class="c1"># Sets up proper credentials for acquiring data through rasterio</span>
<span class="n">aws_session</span> <span class="o">=</span> <span class="n">AWSSession</span><span class="p">(</span><span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(),</span> <span class="n">requester_pays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Extract geometry bounds from the ICESat-2 KML file used above so that we can perform the Landsat spatial search.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract geometry bounds</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">jk</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will search for imagery in STAC catalog using satsearch:
<a class="reference external" href="https://github.com/sat-utils/sat-search">https://github.com/sat-utils/sat-search</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search STAC API for Landsat images based on a bounding box, date and other metadata if desired</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">#(west, south, east, north) </span>

<span class="n">timeRange</span> <span class="o">=</span> <span class="s1">&#39;2019-05-06/2019-05-07&#39;</span>
    
<span class="n">results</span> <span class="o">=</span> <span class="n">Search</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://landsatlook.usgs.gov/stac-server&#39;</span><span class="p">,</span>
                        <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;usgs-landsat/collection02/&#39;</span><span class="p">,</span>
                        <span class="n">datetime</span><span class="o">=</span><span class="n">timeRange</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span>    
                        <span class="c1"># properties=properties,</span>
                        <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&lt;datetime&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> items&#39;</span> <span class="o">%</span> <span class="n">results</span><span class="o">.</span><span class="n">found</span><span class="p">())</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

<span class="c1"># Save search to geojson file</span>
<span class="n">gjson_outfile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/home/jovyan/website2022/book/tutorials/DataIntegration/Landsat.geojson&#39;</span>
<span class="n">items</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">gjson_outfile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can include property searches, such as path, row, cloud-cover, as well with the <code class="docutils literal notranslate"><span class="pre">properties</span></code> flag.</p>
<p>We are given a satsearch collection of items (images)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">items</span>
</pre></div>
</div>
</div>
</div>
<p>Load the geojson file into geopandas and inspect the items we want to collect</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the geojson file</span>
<span class="n">gf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gjson_outfile</span><span class="p">)</span>
<span class="n">gf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot search area of interest and frames on a map using Holoviz Libraries (more on these later)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;landsat:wrs_path&#39;</span><span class="p">,</span><span class="s1">&#39;landsat:wrs_row&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">)]</span>
<span class="n">footprints</span> <span class="o">=</span> <span class="n">cols</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;landsat:wrs_path&#39;</span><span class="p">,</span><span class="s1">&#39;landsat:wrs_row&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Landsat 8 T1&#39;</span><span class="p">,</span><span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;ESRI&#39;</span><span class="p">)</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">tile_sources</span><span class="o">.</span><span class="n">CartoEco</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> 
<span class="n">labels</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">tile_sources</span><span class="o">.</span><span class="n">StamenLabels</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;annotation&#39;</span><span class="p">)</span>
<span class="n">tiles</span> <span class="o">*</span> <span class="n">footprints</span> <span class="o">*</span> <span class="n">labels</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="intake-all-scenes-using-the-intake-stac-library">
<h3>Intake all scenes using the intake-STAC library<a class="headerlink" href="#intake-all-scenes-using-the-intake-stac-library" title="Permalink to this headline">¬∂</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Intake-STAC</span></code> facilitates discovering, exploring, and loading spatio-temporal datasets by providing Intake Drivers for STAC catalogs. This provides a simple toolkit for working with STAC catalogs and for loading STAC assets as <code class="docutils literal notranslate"><span class="pre">xarray</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_stac_item_collection</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs explore the metadata and keys for the first scene</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sceneids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
<span class="n">item3</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneids</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">item3</span><span class="o">.</span><span class="n">metadata</span>
<span class="c1"># for keys in item3.keys():</span>
    <span class="c1"># print (keys)</span>
</pre></div>
</div>
</div>
</div>
<p>We can explore the metadata for any of these:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item3</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the url needed to grab data from the S3 bucket</span>
<span class="c1"># From the satsearch catalog:</span>
<span class="n">items</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">asset</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="c1"># can use item asset name or title (blue or B2)</span>

<span class="c1"># From the intake-STAC catalog</span>
<span class="n">item3</span><span class="o">.</span><span class="n">blue</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="c1"># must use item asset name (blue)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="open-and-visualize-each-image-using-rasterio">
<h3>Open and visualize each image using RasterIO<a class="headerlink" href="#open-and-visualize-each-image-using-rasterio" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>

<span class="c1"># Retrieve first scene using rio</span>
<span class="n">item_url</span> <span class="o">=</span> <span class="n">item3</span><span class="o">.</span><span class="n">blue</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">]</span>

<span class="c1"># Read and plot with grid coordinates </span>
<span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">Env</span><span class="p">(</span><span class="n">aws_session</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">item_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="c1"># To plot</span>
        <span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># To open data into a numpy array</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can open directly into <code class="docutils literal notranslate"><span class="pre">xarray</span></code> using <code class="docutils literal notranslate"><span class="pre">rasterIO</span></code>‚Ä¶</p>
</div>
<div class="section" id="manipulating-data-in-xarray">
<h3>Manipulating data in Xarray<a class="headerlink" href="#manipulating-data-in-xarray" title="Permalink to this headline">¬∂</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">xarray</span></code> have very similar structures and ways of manipulating data, but <code class="docutils literal notranslate"><span class="pre">pandas</span></code> excels with 2-D data and <code class="docutils literal notranslate"><span class="pre">xarray</span></code> is ideal for higher dimension data. <code class="docutils literal notranslate"><span class="pre">Xarray</span></code> introduces labels in the form of dimensions, coordinates and attributes on top of Pandas-like DataFrames.</p>
<p><code class="docutils literal notranslate"><span class="pre">Xarray</span></code> has 2 fundamental data structures:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataArray</span></code>, which holds single multi-dimensional variables and its coordinates</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset</span></code>, which holds multiple variables that potentially share the same coordinates</p></li>
</ul>
<a class="reference internal image-reference" href="https://xarray-contrib.github.io/xarray-tutorial/_images/xarray-data-structures.png"><img alt="https://xarray-contrib.github.io/xarray-tutorial/_images/xarray-data-structures.png" src="https://xarray-contrib.github.io/xarray-tutorial/_images/xarray-data-structures.png" style="width: 800px;" /></a>
<p>We will only scratch the surface here on what <code class="docutils literal notranslate"><span class="pre">xarray</span></code> can do. To learn more, there are great <code class="docutils literal notranslate"><span class="pre">xarray</span></code> tutorials here: <a class="reference external" href="https://xarray-contrib.github.io/xarray-tutorial/online-tutorial-series/01_xarray_fundamentals.html">https://xarray-contrib.github.io/xarray-tutorial/online-tutorial-series/01_xarray_fundamentals.html</a></p>
<div class="section" id="rasterio-and-rioxarray">
<h4>RasterIO and RioXarray<a class="headerlink" href="#rasterio-and-rioxarray" title="Permalink to this headline">¬∂</a></h4>
<p>We can use <code class="docutils literal notranslate"><span class="pre">rasterIO</span></code> to easily open into an <code class="docutils literal notranslate"><span class="pre">xarray</span></code> <code class="docutils literal notranslate"><span class="pre">DataArray</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rastxr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">item_url</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s1">&#39;rasterio&#39;</span><span class="p">)</span>
<span class="n">rastxr</span>
</pre></div>
</div>
</div>
</div>
<p>Or a <code class="docutils literal notranslate"><span class="pre">DataSet</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rastxr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">item_url</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s1">&#39;rasterio&#39;</span><span class="p">)</span>
<span class="n">rastxr</span>
</pre></div>
</div>
</div>
</div>
<p>We can open using rioxarray, which integrates <code class="docutils literal notranslate"><span class="pre">rasterIO</span></code> and <code class="docutils literal notranslate"><span class="pre">xarray</span></code> and is the most efficient way of opening using <code class="docutils literal notranslate"><span class="pre">rasterIO</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rioxarray</span> <span class="k">as</span> <span class="nn">rxr</span>

<span class="n">rastrxr</span> <span class="o">=</span> <span class="n">rxr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">item_url</span><span class="p">)</span>
<span class="n">rastrxr</span>
</pre></div>
</div>
</div>
</div>
<p>We can see <code class="docutils literal notranslate"><span class="pre">Attributes</span></code> have been added to the Xarray using the same url.</p>
<p>Beyond what <code class="docutils literal notranslate"><span class="pre">xarray</span></code> and <code class="docutils literal notranslate"><span class="pre">rasterIO</span></code> provide, <code class="docutils literal notranslate"><span class="pre">rioxarray</span></code> has these added benefits (plus others):</p>
<ul class="simple">
<li><p>Supports multidimensional datasets such as netCDF</p></li>
<li><p>Loads in the CRS, transform, and nodata metadata in standard CF &amp; GDAL locations</p></li>
<li><p>Supports masking and scaling data</p></li>
<li><p>Loads raster metadata into the attributes</p></li>
</ul>
<p>For more info: <a class="reference external" href="https://corteva.github.io/rioxarray/stable/index.html">https://corteva.github.io/rioxarray/stable/index.html</a></p>
</div>
<div class="section" id="dask">
<h4>Dask<a class="headerlink" href="#dask" title="Permalink to this headline">¬∂</a></h4>
<p>Another convenient means for opening a lot of raster data into <code class="docutils literal notranslate"><span class="pre">xarray</span></code> is using <code class="docutils literal notranslate"><span class="pre">dask</span></code>. <code class="docutils literal notranslate"><span class="pre">Xarray</span></code> integrates with Dask to support parallel computations and streaming computation on datasets that don‚Äôt fit into memory. So this is perfect when you want to process a lot of data.</p>
<p><code class="docutils literal notranslate"><span class="pre">Dask</span></code> divides arrays into many small pieces, called chunks, each of which is presumed to be small enough to fit into memory.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">NumPy</span></code>, which has eager evaluation, operations on <code class="docutils literal notranslate"><span class="pre">dask</span></code> arrays are lazy. Operations queue up a series of tasks mapped over blocks, and no computation is performed until you actually ask values to be computed (e.g., to print results to your screen or write to disk). At that point, data is loaded into memory and computation proceeds in a streaming fashion, block-by-block.</p>
<p>More on Dask in the Cloud Computing Tools tutorial.</p>
<p>To expand our <code class="docutils literal notranslate"><span class="pre">xarray</span></code> toolbox for working with larger data sets that we don‚Äôt necessarily want entirely in memory, we will start by reading in 3 bands of a Landsat scene to <code class="docutils literal notranslate"><span class="pre">xarray</span></code> using <code class="docutils literal notranslate"><span class="pre">dask</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sceneid</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">sceneid</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">band_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span>

<span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Construct xarray for scene</span>
<span class="k">for</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">:</span>
    <span class="c1"># Specify chunk size (x,y), Landsat COG is natively in 512 chunks so is best to use this or a multiple</span>
    <span class="n">band</span> <span class="o">=</span> <span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">](</span><span class="n">chunks</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span><span class="n">urlpath</span><span class="o">=</span><span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span>
    <span class="n">band</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_name</span><span class="p">]</span>
    <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
<span class="n">scene</span>
</pre></div>
</div>
</div>
</div>
<p>Typically, it‚Äôs best to align <code class="docutils literal notranslate"><span class="pre">dask</span></code> <code class="docutils literal notranslate"><span class="pre">chunks</span></code> with the way image chunks (typically called ‚Äútiles‚Äù) are stored on disk or cloud storage buckets. The landsat data is stored on AWS S3 in a tiled Geotiff format where tiles are 512x512, so we should pick some multiple of that, and typically aim for chunk sizes of ~100Mb (although this is subjective). You can read more about <code class="docutils literal notranslate"><span class="pre">dask</span></code> chunks here: <a class="reference external" href="https://docs.dask.org/en/latest/array-best-practices.html">https://docs.dask.org/en/latest/array-best-practices.html</a>.</p>
<p>Similarly as with <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, we can explore variables easily in <code class="docutils literal notranslate"><span class="pre">xarray</span></code>. This time we can work with coordinates (equivalent to indices in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>). Here <code class="docutils literal notranslate"><span class="pre">x</span></code> might often be the longitude (it can be renamed to this actually):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<p>We can also keep track of arbitrary metadata (called attributes) in the form of a Python dictionary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<p>We can apply operations over dimensions by name. Here, if we want to slice the data to only have the blue band:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that instead of <code class="docutils literal notranslate"><span class="pre">loc</span></code> (from <code class="docutils literal notranslate"><span class="pre">pandas</span></code>) we are using <code class="docutils literal notranslate"><span class="pre">sel</span></code>, but they function synonymously.</p>
<p>Mathematical operations (e.g., x - y) vectorize across multiple dimensions (array broadcasting) based on dimension names. Let‚Äôs determine the mean reflectance for the blue band:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="c1">#.values</span>
</pre></div>
</div>
</div>
</div>
<p>And you can easily use the split-apply-combine paradigm with groupby, which we won‚Äôt show here.</p>
</div>
</div>
<div class="section" id="advanced-multi-dimensional-read-ins-manipulation-and-visualization">
<h3>Advanced multi-dimensional read-ins, manipulation and visualization<a class="headerlink" href="#advanced-multi-dimensional-read-ins-manipulation-and-visualization" title="Permalink to this headline">¬∂</a></h3>
<p>Now let‚Äôs open all the bands and multiple days together into an <code class="docutils literal notranslate"><span class="pre">xarray</span></code>. This will be a more complex <code class="docutils literal notranslate"><span class="pre">xarray</span></code> with an extra <code class="docutils literal notranslate"><span class="pre">'time'</span></code> dimension. Since the catalog we have has a combination of Level 1 and 2 data, let‚Äôs keep only the scene IDs for Level 1 data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sceneids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
<span class="n">sceneids</span> <span class="o">=</span> <span class="p">[</span><span class="n">sceneid</span> <span class="k">for</span> <span class="n">sceneid</span> <span class="ow">in</span> <span class="n">sceneids</span> <span class="k">if</span> <span class="n">sceneid</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_T1&#39;</span><span class="p">)]</span>
<span class="n">sceneids</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs create the time variable first for the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> time dimension. This finds the desired scene IDs in the <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> dataframe we have above and extracts their ‚Äòdatetime‚Äô information. These datetimes get recorded into an <code class="docutils literal notranslate"><span class="pre">xarray</span></code> variable object for ‚Äòtime‚Äô.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create time variable for time dim</span>
<span class="n">time_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">gf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sceneids</span><span class="p">)][</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
<span class="n">time_var</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will search and collect band names for grabbing each desired band. We will just grab the bands that have 30 m pixels. This provides and example of how you can search data in the STAC catalog.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Get band names</span>
<span class="n">sceneid</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneids</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sceneid</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sceneid</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span>
    <span class="k">if</span> <span class="s1">&#39;eo:bands&#39;</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
        <span class="n">resol</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="s1">&#39;eo:bands&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gsd&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resol</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span> 
            <span class="n">band_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            
<span class="c1"># Add qa band</span>
<span class="n">band_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;qa_pixel&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And now open all of it‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import to xarray</span>
<span class="c1"># In xarray dataframe nans are in locations where concat of multiple scenes has expanded the grid (i.e. different path/rows).</span>
<span class="n">scenes</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">sceneid</span> <span class="ow">in</span> <span class="n">sceneids</span><span class="p">:</span>
    <span class="n">sceneid</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneid</span><span class="p">]</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">sceneid</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Construct xarray for scene, open each band, append and concatenate together to create a scene, </span>
    <span class="c1"># then append and concatenate each scene to create the full dataframe </span>
    <span class="k">for</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">:</span>
        <span class="n">band</span> <span class="o">=</span> <span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">](</span><span class="n">chunks</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span><span class="n">urlpath</span><span class="o">=</span><span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span>
        <span class="n">band</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_name</span><span class="p">]</span>
        <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
    <span class="n">scenes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>

<span class="c1"># Concatenate scenes with time variable</span>
<span class="n">ls_scenes</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">scenes</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">time_var</span><span class="p">)</span>

<span class="n">ls_scenes</span>
</pre></div>
</div>
</div>
</div>
<p>We now have 2 Landsat scenes with all of the bands we are interested in stored in an <code class="docutils literal notranslate"><span class="pre">xarray</span></code>, but you can imagine that this exact code can scale to years worth of data and bands.</p>
<p><code class="docutils literal notranslate"><span class="pre">Stack-STAC</span></code> is another package that works similarly and may be more efficient for searching and reading in data from a STAC catalog. However, we will not show it here because it may not be as flexible for reading in selected data and isn‚Äôt as transparent in how it builds a <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> (<a class="reference external" href="https://github.com/gjoseph92/stackstac">https://github.com/gjoseph92/stackstac</a>).</p>
<p>From here, we easily subset one image at a time or the entire <code class="docutils literal notranslate"><span class="pre">xarray</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sbands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;nir08&#39;</span><span class="p">,</span> <span class="s1">&#39;swir16&#39;</span><span class="p">]</span>

<span class="c1"># Select the first datetime</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ls_scenes</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># Upper left and lower right coordinates for subsetting to Jakobshavn area</span>
<span class="n">ulx</span> <span class="o">=</span> <span class="mi">300000</span>
<span class="n">uly</span> <span class="o">=</span> <span class="mi">7695000</span>
<span class="n">lrx</span> <span class="o">=</span> <span class="mi">330000</span>
<span class="n">lry</span> <span class="o">=</span> <span class="mi">7670000</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">ls_scenes</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">band</span><span class="o">=</span><span class="n">sbands</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lry</span><span class="p">,</span><span class="n">uly</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">ulx</span><span class="p">,</span><span class="n">lrx</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">image</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Since this data is in UTM 22N, we can reproject to the standard lat/lon coordinate system (WGS-84) and map with the ICESat-2 and ATM lines. However, we realized the CRS data was inaccurate in the DataArray in comparison to the STAC catalog‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;proj:epsg&#39;</span><span class="p">])</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The inaccurate CRS lableling is something that may arise with some Landsat UTMs so if you plot your data after reprojecting and it looks wild, double check that you started with the correct UTM information.</p>
<p>We re-label our CRS info in our <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> to correct this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="mi">32623</span><span class="p">)</span>
<span class="n">image</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can reproject and map!!!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

<span class="n">ISlats</span> <span class="o">=</span> <span class="p">[</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
<span class="n">ISlons</span> <span class="o">=</span> <span class="p">(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="n">ATMlats</span> <span class="o">=</span> <span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
<span class="n">ATMlons</span> <span class="o">=</span> <span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">image</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ISlons</span><span class="p">,</span><span class="n">ISlats</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ATMlons</span><span class="p">,</span><span class="n">ATMlats</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And there we are! ICESat-2 and ATM lines plotted on top of Landsat 8 imagery.</p>
</div>
</div>
<div class="section" id="summary">
<h2>4. Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¬∂</a></h2>
<p>Congratulations! You‚Äôve completed the tutorial. In this tutorial you have gained the skills to:</p>
<ul class="simple">
<li><p>Search for non-ICESat-2 datasets</p></li>
<li><p>Open data into <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">xarray</span></code> dataframes/arrays, and</p></li>
<li><p>Manipulate, visualize, and explore the data</p></li>
</ul>
<p>We have concluded by mapping the three data sets together. We will revisit the ICESat-2 and ATM data at Jakobshavn and integrate it with processed velocity data in Part II of this tutorial tomorrow!</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/DataIntegration"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../DataVisualization/Visualization_geemap_use_examples.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">OpenAltimery and GEE Use Examples</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="dataintegration-2.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Data integration with ICESat-2 - Part II</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By eScience Institute, University of Washington<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>