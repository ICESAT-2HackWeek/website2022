
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data integration with ICESat-2 - Part I &#8212; ICESat-2 Hackweek 2022</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Interactive Visualizion with Open Altimetry &amp; Google Earth Engine" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html" />
    <link rel="prev" title="Geospatial Transformations In-depth" href="../geospatial/geospatial-advanced.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LZVEY6377Z"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-LZVEY6377Z');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ICESat-2 Hackweek 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to ICESat-2 Hackweek!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Details
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../application.html">
   Application
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=schedule">
   Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://icesat-2.hackweek.io/index.html?jump_to=team">
   Team
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../mission.html">
   Hackweek Mission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../CoC.html">
   Event Code of Conduct
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preparation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../preliminary/index.html">
   Preliminary Work
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/swc.html">
     Software Carpentry Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/github.html">
     GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/jupyterhub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/git.html">
     Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthdata.html">
     Earthdata Login
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/earthengine.html">
     Google Earth Engine Sign-Up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preliminary/python.html">
     Python Installation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter.html">
     GitHub, Git, JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataProducts/DataProducts.html">
     ICESat-2 data products
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../data_access/data_access_1_intro.html">
     ICESat-2 Data Discovery, Visualization, and Access Resources
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_access/data_access_2_earthdata.html">
       Data Discovery and Access via
       <strong>
        earthdata
       </strong>
       library
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_access/data_access_3_icepyx.html">
       Accessing ICESat-2 Data Using icepyx
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../geospatial/geospatial-intro.html">
     Geospatial Transforms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../geospatial/geospatial-advanced.html">
       Geospatial Transformations In-depth
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Data integration with ICESat-2 - Part I
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html">
     Interactive Visualizion with Open Altimetry &amp; Google Earth Engine
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../DataVisualization/Visualization_geemap_use_examples.html">
       OpenAltimery and GEE Use Examples
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dataintegration-2.html">
     Data integration with ICESat-2 - Part II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud-computing/cloud-computing-tutorial.html">
     Cloud Computing Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../DataVisualization/dataviz2d.html">
     <strong>
      Making nice maps for posters with Python
     </strong>
     🗺️+🐍
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../projects/index.html">
   Projects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roles.html">
     Project Roles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_roadmap.html">
     Project Roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/project_initialization.html">
     Project Initialization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../projects/list_of_projects.html">
     List of Projects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/glossary.html">
   Glossaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/IS2-resources.html">
   ICESat-2 Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/open_source_software.html">
   Open-source Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/questions.html">
   How to Get Help
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tutorials/DataIntegration/dataintegration-1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ICESAT-2HackWeek/website2022"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ICESAT-2HackWeek/website2022/issues/new?title=Issue%20on%20page%20%2Ftutorials/DataIntegration/dataintegration-1.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ICESAT-2HackWeek/website2022/edit/main/book/tutorials/DataIntegration/dataintegration-1.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ICESAT-2HackWeek/website2022/main?urlpath=lab/tree/book/tutorials/DataIntegration/dataintegration-1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#needed-libraries">
   Needed libraries:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-environment">
   Computing environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-and-acquire-the-icesat2-product-s-of-interest">
   Identify and acquire the ICESat2 product(s) of interest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-icesat-2-atl03-data-from-desired-region">
     Download ICESat-2 ATL03 data from desired region
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-other-products-of-interest-and-their-space-time-boundaries">
   Identify other products of interest, and their space/time boundaries
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-data-are-needed-to-supplement-and-enhance-is2-observations">
     What data are needed to supplement and enhance IS2 observations?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#where-are-the-other-data-sets-stored">
     Where are the other data sets stored?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acquire-non-cloud-data-and-open-atm-data-access">
   Acquire non-cloud data and open: ATM data access
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#opening-and-manipulating-data-in-pandas">
     Opening and manipulating data in Pandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#slicing">
       Slicing
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statistical-manipulations">
       Statistical manipulations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   Exercise
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multi-indexing">
     Multi-indexing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-landsat-images-from-the-cloud">
   Download (Landsat) images from the cloud:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-data-in-the-cloud-from-s3-buckets">
     Using data in the cloud from S3 buckets:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-and-open-landsat-images-in-the-cloud">
   Find and open Landsat images in the cloud
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intake-all-scenes-using-the-intake-stac-library">
     Intake all scenes using the intake-STAC library
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#should-i-keep-next-cell">
   Should I keep next cell?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-data-in-xarray">
     Manipulating data in Xarray
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data integration with ICESat-2 - Part I</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#needed-libraries">
   Needed libraries:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-environment">
   Computing environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-and-acquire-the-icesat2-product-s-of-interest">
   Identify and acquire the ICESat2 product(s) of interest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-icesat-2-atl03-data-from-desired-region">
     Download ICESat-2 ATL03 data from desired region
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-other-products-of-interest-and-their-space-time-boundaries">
   Identify other products of interest, and their space/time boundaries
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-data-are-needed-to-supplement-and-enhance-is2-observations">
     What data are needed to supplement and enhance IS2 observations?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#where-are-the-other-data-sets-stored">
     Where are the other data sets stored?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acquire-non-cloud-data-and-open-atm-data-access">
   Acquire non-cloud data and open: ATM data access
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#opening-and-manipulating-data-in-pandas">
     Opening and manipulating data in Pandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#slicing">
       Slicing
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statistical-manipulations">
       Statistical manipulations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   Exercise
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multi-indexing">
     Multi-indexing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-landsat-images-from-the-cloud">
   Download (Landsat) images from the cloud:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-data-in-the-cloud-from-s3-buckets">
     Using data in the cloud from S3 buckets:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-and-open-landsat-images-in-the-cloud">
   Find and open Landsat images in the cloud
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intake-all-scenes-using-the-intake-stac-library">
     Intake all scenes using the intake-STAC library
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#should-i-keep-next-cell">
   Should I keep next cell?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-data-in-xarray">
     Manipulating data in Xarray
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="data-integration-with-icesat-2-part-i">
<h1>Data integration with ICESat-2 - Part I<a class="headerlink" href="#data-integration-with-icesat-2-part-i" title="Permalink to this headline">¶</a></h1>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning Objectives</p>
<p><strong>Goals</strong></p>
<ul class="simple">
<li><p>Identify and locate non-ICESat-2 data sets</p></li>
<li><p>Acquiring data from the cloud or via download</p></li>
<li><p>Open data in Pandas and Xarray and basic functioning of DataFrames</p></li>
</ul>
</div>
<p>☝️ This formatting is a Jupyter Book <a class="reference external" href="https://jupyterbook.org/content/content-blocks.html#notes-warnings-and-other-admonitions">admonition</a>, that uses a custom version of Markdown called <a class="reference internal" href="../../reference/glossary.html#term-MyST"><span class="xref std std-term">MyST</span></a></p>
<div class="section" id="needed-libraries">
<h2>Needed libraries:<a class="headerlink" href="#needed-libraries" title="Permalink to this headline">¶</a></h2>
<p>satsearch <br />
boto</p>
<p>matplotlib widget extension</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">sat</span><span class="o">-</span><span class="n">search</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">boto3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">intake</span><span class="o">-</span><span class="n">stac</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="computing-environment">
<h2>Computing environment<a class="headerlink" href="#computing-environment" title="Permalink to this headline">¶</a></h2>
<p>We’ll be using the following open source Python libraries in this notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipyleaflet</span>
<span class="kn">from</span> <span class="nn">ipyleaflet</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">GeoData</span><span class="p">,</span> <span class="n">LayersControl</span><span class="p">,</span><span class="n">Rectangle</span><span class="p">,</span> <span class="n">basemaps</span><span class="p">,</span> <span class="n">basemap_to_tiles</span><span class="p">,</span> <span class="n">TileLayer</span><span class="p">,</span> <span class="n">SplitMapControl</span><span class="p">,</span> <span class="n">Polygon</span>

<span class="kn">import</span> <span class="nn">ipywidgets</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %matplotlib widget</span>
<span class="kn">import</span> <span class="nn">satsearch</span>
<span class="kn">from</span> <span class="nn">satsearch</span> <span class="kn">import</span> <span class="n">Search</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geoviews</span> <span class="k">as</span> <span class="nn">gv</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">intake</span> <span class="c1"># if you&#39;ve installed intake-STAC, it will automatically import alongside intake</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">from</span> <span class="nn">rasterio.session</span> <span class="kn">import</span> <span class="n">AWSSession</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">dask.utils</span> <span class="kn">import</span> <span class="n">SerializableLock</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hvplot.xarray</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Proj</span><span class="p">,</span> <span class="n">transform</span>

<span class="c1"># Suppress library deprecation warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="identify-and-acquire-the-icesat2-product-s-of-interest">
<h2>Identify and acquire the ICESat2 product(s) of interest<a class="headerlink" href="#identify-and-acquire-the-icesat2-product-s-of-interest" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>What is the application of this product?</p></li>
<li><p>What region and resolution is needed?</p></li>
</ul>
<div class="section" id="download-icesat-2-atl03-data-from-desired-region">
<h3>Download ICESat-2 ATL03 data from desired region<a class="headerlink" href="#download-icesat-2-atl03-data-from-desired-region" title="Permalink to this headline">¶</a></h3>
<p>Remember icepyx? We are going to use that again to download some ICESat-2 ATL06 data over our region of interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">icepyx</span> <span class="k">as</span> <span class="nn">ipx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specifying the necessary icepyx parameters</span>
<span class="n">short_name</span> <span class="o">=</span> <span class="s1">&#39;ATL06&#39;</span>
<span class="n">spatial_extent</span> <span class="o">=</span> <span class="s1">&#39;hackweek_kml_jakobshavan.kml&#39;</span> <span class="c1"># KML polygon centered on Jakobshavan</span>
<span class="n">date_range</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2019-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-04-30&#39;</span><span class="p">]</span>
<span class="n">rgts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;338&#39;</span><span class="p">]</span> <span class="c1"># IS-2 RGT of interest</span>
</pre></div>
</div>
</div>
</div>
<p>You may notice that we specified a RGT track. As seen below, a large number of ICESat-2 overpasses occur for Jakobshavan. In the interest of time (and computer memory), we are going to look at only one of these tracks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show image of area of interest (data viz tutorial will get in deeper so don&#39;t explain much):</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">69.2</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">]</span>
<span class="n">zoom</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># Open KML file for visualizing</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">fiona</span><span class="o">.</span><span class="n">drvsupport</span><span class="o">.</span><span class="n">supported_drivers</span><span class="p">[</span><span class="s1">&#39;KML&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rw&#39;</span>
<span class="n">jk</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">spatial_extent</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;KML&#39;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">basemap</span><span class="o">=</span><span class="n">basemap_to_tiles</span><span class="p">(</span><span class="n">basemaps</span><span class="o">.</span><span class="n">NASAGIBS</span><span class="o">.</span><span class="n">ModisAquaTrueColorCR</span><span class="p">,</span> <span class="s1">&#39;2020-07-18&#39;</span><span class="p">),</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
<span class="n">geo_data</span> <span class="o">=</span> <span class="n">GeoData</span><span class="p">(</span><span class="n">geo_dataframe</span> <span class="o">=</span> <span class="n">jk</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">geo_data</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">LayersControl</span><span class="p">())</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the Query object</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">ipx</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">short_name</span><span class="p">,</span> <span class="n">spatial_extent</span><span class="p">,</span> <span class="n">date_range</span><span class="p">,</span> <span class="n">tracks</span><span class="o">=</span><span class="n">rgts</span><span class="p">)</span>

<span class="c1"># Show the available granules</span>
<span class="n">region</span><span class="o">.</span><span class="n">avail_granules</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like we have an ICESat-2 track! Let’s quickly visualize the data to ensure that there are no clouds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Request information from OpenAltimetry</span>
<span class="n">cyclemap</span><span class="p">,</span> <span class="n">rgtmap</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">visualize_elevation</span><span class="p">()</span>

<span class="n">rgtmap</span>
</pre></div>
</div>
</div>
</div>
<p>Looks good! Now it’s time to download the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Earthdata credentials</span>
<span class="n">uid</span> <span class="o">=</span> <span class="s1">&#39;zhfair&#39;</span>
<span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;zhfair@umich.edu&#39;</span>
<span class="n">region</span><span class="o">.</span><span class="n">earthdata_login</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

<span class="c1"># Order the granules</span>
<span class="n">region</span><span class="o">.</span><span class="n">order_granules</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the data</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/home/jovyan/website2022/book/tutorials/DataIntegration/&#39;</span>
<span class="n">region</span><span class="o">.</span><span class="n">download_granules</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># Load the ICESat-2 data. We will just look at the central beams (GT2R/L)</span>
<span class="n">is2_file</span> <span class="o">=</span> <span class="s1">&#39;processed_ATL06_20190420093051_03380303_005_01_full.h5&#39;</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">is2_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">is2_gt2r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/latitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/longitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2r/land_ice_segments/h_li&#39;</span><span class="p">][:]})</span>
    <span class="n">is2_gt2l</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/latitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/longitude&#39;</span><span class="p">][:],</span>
                                  <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;gt2l/land_ice_segments/h_li&#39;</span><span class="p">][:]})</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="identify-other-products-of-interest-and-their-space-time-boundaries">
<h2>Identify other products of interest, and their space/time boundaries<a class="headerlink" href="#identify-other-products-of-interest-and-their-space-time-boundaries" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-data-are-needed-to-supplement-and-enhance-is2-observations">
<h3>What data are needed to supplement and enhance IS2 observations?<a class="headerlink" href="#what-data-are-needed-to-supplement-and-enhance-is2-observations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Satellite or in situ data sets?</p></li>
<li><p>We will show ATM (non-AWS) and Landsat (AWS)</p></li>
</ul>
</div>
<div class="section" id="where-are-the-other-data-sets-stored">
<h3>Where are the other data sets stored?<a class="headerlink" href="#where-are-the-other-data-sets-stored" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Cloud datasets in AWS
<a class="reference external" href="https://registry.opendata.aws/">https://registry.opendata.aws/</a></p></li>
<li><p>EarthData
<a class="reference external" href="https://search.earthdata.nasa.gov/search/">https://search.earthdata.nasa.gov/search/</a></p></li>
</ul>
<p>ATM: <a class="reference external" href="https://search.earthdata.nasa.gov/search/granules?p=C1000000062-NSIDC_ECS&amp;pg%5B0%5D%5Bv%5D=f&amp;pg%5B0%5D%5Bgsk%5D=-start_date&amp;sb%5B0%5D=-50.56835%2C68.83371%2C-49.00139%2C69.56591&amp;fi=ATM&amp;as%5Binstrument%5D%5B0%5D=ATM&amp;tl=1646767454.667%213%21%21&amp;m=67.08956509568404%21-48.11572265625%216%211%210%210%2C2">https://search.earthdata.nasa.gov/search/granules?p=C1000000062-NSIDC_ECS&amp;pg[0][v]=f&amp;pg[0][gsk]=-start_date&amp;sb[0]=-50.56835,68.83371,-49.00139,69.56591&amp;fi=ATM&amp;as[instrument][0]=ATM&amp;tl=1646767454.667!3!!&amp;m=67.08956509568404!-48.11572265625!6!1!0!0,2</a> <br />
Sentinel-2: <a class="reference external" href="https://registry.opendata.aws/sentinel-2/">https://registry.opendata.aws/sentinel-2/</a> <br />
Landsat: <a class="reference external" href="https://registry.opendata.aws/usgs-landsat/">https://registry.opendata.aws/usgs-landsat/</a></p>
</div>
</div>
<div class="section" id="acquire-non-cloud-data-and-open-atm-data-access">
<h2>Acquire non-cloud data and open: ATM data access<a class="headerlink" href="#acquire-non-cloud-data-and-open-atm-data-access" title="Permalink to this headline">¶</a></h2>
<p>Why did we choose April 2019 and RGT 338? In Spring 2019, an airborne campaign called Operation IceBridge was flown across Jakobshavan as validation for ICESat-2. Onboard was the Airborne Topographic Mapper, a lidar that works at both 532 nm (like ICESat-2) and 1064 nm (near-infrared). More information about Operation IceBridge and ATM may be found here: <a class="reference external" href="https://nsidc.org/data/icebridge">https://nsidc.org/data/icebridge</a></p>
<p>Here, we are going to try and co-register ATM spot measurements with ICESat-2. Because both data sets are rather large, this can be computationally expensive, so we will only consider one flight track with the ATM 532 nm beam.</p>
<p>Operation IceBridge data is not available on the cloud, so this data was downloaded directly from NSIDC. If you are interested in using IceBridge data, NSIDC has a useful data portal here: <a class="reference external" href="https://nsidc.org/icebridge/portal/map">https://nsidc.org/icebridge/portal/map</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the ATM data into a DataFrame</span>
<span class="n">atm_file</span> <span class="o">=</span> <span class="s1">&#39;ILATM2_20190506_151600_smooth_nadir3seg_50pt.csv&#39;</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atm_file</span><span class="p">)</span>

<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="opening-and-manipulating-data-in-pandas">
<h3>Opening and manipulating data in Pandas<a class="headerlink" href="#opening-and-manipulating-data-in-pandas" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Change the longitudes to be consistent with ICESat-2</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>
</pre></div>
</div>
</div>
</div>
<p>Pandas excels at helping you explore, clean, and process tabular data, such as data stored in spreadsheets or databases. In pandas, a Series is a 1-D data table and the 2-D data table is called a DataFrame, which we saw just above.</p>
<p>Read csv is the easiest way to open a csv data file into a pandas DataFrame. We can specify formatting, data selection, indexing and much more when reading any data into a pandas DataFrame. Here I specify different headers, assign the first column as the index, and the first column as the header (even though we are renaming it, so that it doesn’t get read in with data).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data with specific headers</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Height&#39;</span><span class="p">,</span> <span class="s1">&#39;South-to-North_Slope&#39;</span><span class="p">,</span>
       <span class="s1">&#39;West-to-East_Slope&#39;</span><span class="p">,</span> <span class="s1">&#39;RMS_Fit&#39;</span><span class="p">,</span> <span class="s1">&#39;Number_Measurements&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Number_Measurements_Removed&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Distance_Of_Block_To_The_Right_Of_Aircraft&#39;</span><span class="p">,</span> <span class="s1">&#39;Track_Identifier&#39;</span><span class="p">]</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atm_file</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset the ICESat-2 data to the ATM latitudes</span>
<span class="n">is2_gt2r</span> <span class="o">=</span> <span class="n">is2_gt2r</span><span class="p">[(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>
<span class="n">is2_gt2l</span> <span class="o">=</span> <span class="n">is2_gt2l</span><span class="p">[(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>


<span class="c1"># Set up a map with the flight tracks as overlays</span>
<span class="kn">from</span> <span class="nn">ipyleaflet</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">basemaps</span><span class="p">,</span> <span class="n">basemap_to_tiles</span><span class="p">,</span> <span class="n">Polyline</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span>
    <span class="n">basemap</span><span class="o">=</span><span class="n">basemap_to_tiles</span><span class="p">(</span><span class="n">basemaps</span><span class="o">.</span><span class="n">Esri</span><span class="o">.</span><span class="n">WorldImagery</span><span class="p">),</span>
    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mf">69.25</span><span class="p">,</span> <span class="mf">310.35</span><span class="o">-</span><span class="mi">360</span><span class="p">),</span>
    <span class="n">zoom</span><span class="o">=</span><span class="mi">11</span>
<span class="p">)</span>

<span class="n">gt2r_line</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span>
    <span class="n">locations</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">is2_gt2r</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span> <span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">gt2r_line</span><span class="p">)</span>

<span class="n">gt2l_line</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span>
    <span class="n">locations</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">is2_gt2l</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span> <span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">gt2l_line</span><span class="p">)</span>

<span class="n">atm_line</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span>
    <span class="n">locations</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Latitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Longitude(deg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span> <span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">atm_line</span><span class="p">)</span>

<span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<p><br />
Now we can explore the data and DataFrame functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">Lat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><br />
If we want something more intuitive as an index</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add datetime for index</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">atm_file</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">atm_l2</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;DateTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">time</span>
<span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;DateTime&#39;</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><br />
Now we can easily slice data by date, month, day, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;2019-05-06&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><br />
Or by a range of dates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;2019-05-06&#39;</span><span class="p">:</span><span class="s1">&#39;2019-05-07&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="slicing">
<h4>Slicing<a class="headerlink" href="#slicing" title="Permalink to this headline">¶</a></h4>
<p>Two methods for slicing:</p>
<ul class="simple">
<li><p>.loc for label-based indexing</p></li>
<li><p>.iloc for positional indexing</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use loc to slice specific indices</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-05-06 15:16:09.750&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select indices and columns</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-05-06 15:16:09.750&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Lon&#39;</span><span class="p">,</span> <span class="s1">&#39;Height&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use iloc to select by row and column number</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="statistical-manipulations">
<h4>Statistical manipulations<a class="headerlink" href="#statistical-manipulations" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group rows together by a column and take the mean of each group</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;30S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>One alternative to using a loop to iterate over a DataFrame is to use the pandas <strong>apply()</strong> method. This function acts as a map() function in Python. It takes a function as an input and applies this function to an entire DataFrame.If you are working with tabular data, you must specify an axis you want your function to act on (0 for columns; and 1 for rows). Much like the map() function, the apply() method can also be used with anonymous functions or lambda functions. Let’s look at some apply() examples using baseball data.</p>
<p>First, you will call the .apply() method on the atm_l2 dataframe. Then use the lambda function to iterate over the rows of the dataframe. For every row, we grab the Number_Measurements and Number_Measurements_Removed columns and pass them to the calc_total function. Finally, you will specify the axis=1 to tell the .apply() method that we want to apply it on the rows instead of columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_total</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">total</span>

<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Total_Measurements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calc_total</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Number_Measurements&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Number_Measurements_Removed&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h2>
<p>Try making apply work with this new function to create a new column, ‘Distance_to_Jakobshavn’, by using the Lat and Lon as inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">radians</span>

<span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate distance between a set point and a lat lon pair</span>
<span class="sd">    a = lat</span>
<span class="sd">    b = lon</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">jlat</span><span class="p">,</span><span class="n">jlon</span> <span class="o">=</span> <span class="mf">69.2330</span><span class="p">,</span> <span class="o">-</span><span class="mf">49.2434</span>
    
    <span class="c1"># approximate radius of earth in km</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">6373.0</span>

    <span class="n">lat1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">jlat</span><span class="p">)</span>
    <span class="n">lon1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">jlon</span><span class="p">)</span>
    <span class="n">lat2</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">lon2</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="n">distance</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">distance</span>

<span class="n">atm_l2</span><span class="p">[</span><span class="s1">&#39;Distance_to_Jakobshavn&#39;</span><span class="p">]</span> 
<span class="c1"># = atm_l2.apply(lambda row: calc_distance(row[&#39;Lat&#39;], row[&#39;Lon&#39;]), axis=1)</span>
<span class="c1"># atm_l2.head()</span>
</pre></div>
</div>
</div>
</div>
<p>Reset index to start fresh for multi-indexing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">atm_l2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multi-indexing">
<h3>Multi-indexing<a class="headerlink" href="#multi-indexing" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span> <span class="o">=</span> <span class="n">atm_l2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;DateTime&#39;</span><span class="p">,</span><span class="s1">&#39;Track_Identifier&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">atm_l2</span>
</pre></div>
</div>
</div>
</div>
<p>To clear up some terminology, the levels of a MultiIndex are the former column names (UTC, Track_Identifier). The labels are the actual values in a level, (54969.50, 0-?, …). Levels can be referred to by name or position, with 0 being the outermost level.</p>
<p>Slicing the outermost index level is pretty easy, we just use our regular .loc[row_indexer, column_indexer]. We’ll select the columns Lat and Long where the UTC was —.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,</span><span class="s1">&#39;2019-05-06 15:16:09.750&#39;</span><span class="p">],[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lon&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>If you wanted to select the rows whose track was 0 or 1, .loc wants [row_indexer, column_indexer] so let’s wrap the two elements of our row indexer (the list of UTCs and the Tracks) in a tuple to make it a single unit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[([</span><span class="s1">&#39;2019-05-06 15:16:09.500&#39;</span><span class="p">,</span><span class="s1">&#39;2019-05-06 15:16:09.750&#39;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lon&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Now you want info from any UTC but for the specific tracks again (0,1). Below the : indicates all labels in this level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lon&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Many attributes and functions to explore with pandas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atm_l2</span><span class="o">.</span> 
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="download-landsat-images-from-the-cloud">
<h2>Download (Landsat) images from the cloud:<a class="headerlink" href="#download-landsat-images-from-the-cloud" title="Permalink to this headline">¶</a></h2>
<p>An Amazon Web Services (AWS) account is required to directly access Landsat data in
the cloud housed within the usgs-landsat S3 requester pays bucket. Users can also find
all objects within the Landsat record by using either the SpatioTemporal Asset Catalog
(STAC) Browser (s3) or Satellite (SAT) Application Programming Interface (API) (https).</p>
<p>Scene location - <a class="reference external" href="https://landsat-pds.s3.amazonaws.com/c1/L8/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/">https://landsat-pds.s3.amazonaws.com/c1/L8/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/</a> <br />
Scene band url for download - <a class="reference external" href="https://landsat-pds.s3.amazonaws.com/c1/L8/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/LC08_L1TP_202025_20190420_20190507_01_T1_B4.TIF">https://landsat-pds.s3.amazonaws.com/c1/L8/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/LC08_L1TP_202025_20190420_20190507_01_T1_B4.TIF</a></p>
<p>***If you want to only open one Landsat band and not talk too much about COGs: <a class="reference external" href="http://www.acgeospatial.co.uk/cog-part-2-python/">http://www.acgeospatial.co.uk/cog-part-2-python/</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># landsatband = []</span>
<span class="c1"># landsat_fp = &#39;http://landsat-pds.s3.amazonaws.com/c1/L8/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/LC08_L1TP_202025_20190420_20190507_01_T1_&#39;</span>
<span class="c1"># bands=(&#39;4.TIF&#39;, &#39;3.TIF&#39;, &#39;2.TIF&#39;)</span>
<span class="c1"># for i in range(1,11): ## 11 bands of Landsat</span>
<span class="c1">#     band = landsat_fp+&#39;B&#39;+str(i)+&#39;.TIF&#39;</span>
<span class="c1">#     if band.endswith((bands)):</span>
<span class="c1">#         landsatband.append(band)</span>
<span class="c1"># landsatband.sort(reverse=True)    ## because I want the order 4,3,2 (but change if you need to!)</span>
<span class="c1"># print(landsatband)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-data-in-the-cloud-from-s3-buckets">
<h3>Using data in the cloud from S3 buckets:<a class="headerlink" href="#using-data-in-the-cloud-from-s3-buckets" title="Permalink to this headline">¶</a></h3>
<p>Landsat S3 User Manual: <a class="reference external" href="https://d9-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/atoms/files/LSDS-2032-Landsat-Commercial-Cloud-Direct-Access-Users-Guide-v2.pdf.pdf">https://d9-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/atoms/files/LSDS-2032-Landsat-Commercial-Cloud-Direct-Access-Users-Guide-v2.pdf.pdf</a></p>
<p>Scene band url for access - s3://usgs-landsat/collection02/level-2/standard/oli-tirs/2020/202/025/LC08_L1TP_202025_20190420_20190507_01_T1/LC08_L1TP_202025_20190420_20190507_01_T1_B4.TIF</p>
</div>
</div>
<div class="section" id="find-and-open-landsat-images-in-the-cloud">
<h2>Find and open Landsat images in the cloud<a class="headerlink" href="#find-and-open-landsat-images-in-the-cloud" title="Permalink to this headline">¶</a></h2>
<p>How can data formats enable high-speed access?</p>
<ol class="simple">
<li><p>Web Object Storage (e.g., Simple Storage Service )</p></li>
</ol>
<ul class="simple">
<li><p>Inexpensive storage, BUT…</p></li>
<li><p>…access is via HTTP1, not random disk reads</p></li>
<li><p>Does include HTTP “range-get” to retrieve a specific byte range</p></li>
</ul>
<ol class="simple">
<li><p>Cloud optimized approaches</p></li>
</ol>
<ul class="simple">
<li><p>Organize data as an aggregation of small, independently retrievable objects (e.g., zarr, HDF2, Geotiff in the Cloud)</p></li>
<li><p>Allow access to pieces of large objects (e.g., Cloud-Optimized GeoTIFF3,OPeNDAP4 in the Cloud)</p></li>
</ul>
<p>We will be working with Cloud Optimized GeoTIFF (COG). A COG is a GeoTIFF file with an internal organization that enables more efficient workflows in the cloud environment.  It does this by leveraging the ability of clients issuing ​HTTP GET range requests to ask for just the parts of a file they need instead of having to open the entire image or data set.</p>
<p>To explore and access COG’s easily we will use a SpatioTemporal Asset Catalog (STAC). The STAC specification provides a common, machine-readable (JSON) format for describing a wide range of geospatial datasets. STAC’s goal is to make it easier to index and discover any geospatial dataset that can be described by a spatial extent and time. STAC is the way geospatial asset metadata is structured and queried and it makes querrying S3 buckets easier. Learn more here: <a class="reference external" href="https://github.com/radiantearth/stac-spec">https://github.com/radiantearth/stac-spec</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sets up credentials for acquiring images through dask/xarray</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AWS_REQUEST_PAYER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;requester&quot;</span>

<span class="c1"># Need to set up proper credentials for acquiring data through rasterio</span>
<span class="n">aws_session</span> <span class="o">=</span> <span class="n">AWSSession</span><span class="p">(</span><span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(),</span> <span class="n">requester_pays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract geometry bounds for Landsat spatial bbox</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">jk</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will search for imagery in STAC catalog using satsearch:
<a class="reference external" href="https://github.com/sat-utils/sat-search">https://github.com/sat-utils/sat-search</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search STAC API for Landsat images based on a bounding box, date and other metadata if desired</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">51.3229</span><span class="p">,</span> <span class="mf">68.840</span><span class="p">,</span> <span class="o">-</span><span class="mf">48.203</span><span class="p">,</span> <span class="mf">69.616</span><span class="p">)</span> <span class="c1">#(west, south, east, north) </span>

<span class="n">timeRange</span> <span class="o">=</span> <span class="s1">&#39;2019-05-06/2019-05-07&#39;</span>
    
<span class="n">results</span> <span class="o">=</span> <span class="n">Search</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://ibhoyw8md9.execute-api.us-west-2.amazonaws.com/prod&#39;</span><span class="p">,</span>
                        <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;usgs-landsat/collection02/&#39;</span><span class="p">,</span>
                        <span class="n">datetime</span><span class="o">=</span><span class="n">timeRange</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span>    
                        <span class="c1"># properties=properties,</span>
                        <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&lt;datetime&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> items&#39;</span> <span class="o">%</span> <span class="n">results</span><span class="o">.</span><span class="n">found</span><span class="p">())</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

<span class="c1"># Save search to geojson file</span>
<span class="n">gjson_outfile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/home/jovyan/website2022/book/tutorials/DataIntegration/Landsat.geojson&#39;</span>
<span class="n">items</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">gjson_outfile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We are given a satsearch collection of items (images)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">items</span>
</pre></div>
</div>
</div>
</div>
<p>Load the geojson file into geopandas and inspect the items we want to collect</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the geojson file</span>
<span class="n">gf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gjson_outfile</span><span class="p">)</span>
<span class="n">gf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot search area of interest and frames on a map using Holoviz Libraries (more on these later)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;landsat:wrs_path&#39;</span><span class="p">,</span><span class="s1">&#39;landsat:wrs_row&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">)]</span>
<span class="n">footprints</span> <span class="o">=</span> <span class="n">cols</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;landsat:wrs_path&#39;</span><span class="p">,</span><span class="s1">&#39;landsat:wrs_row&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Landsat 8 T1&#39;</span><span class="p">,</span><span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;ESRI&#39;</span><span class="p">)</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">tile_sources</span><span class="o">.</span><span class="n">CartoEco</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> 
<span class="n">labels</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">tile_sources</span><span class="o">.</span><span class="n">StamenLabels</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;annotation&#39;</span><span class="p">)</span>
<span class="n">tiles</span> <span class="o">*</span> <span class="n">footprints</span> <span class="o">*</span> <span class="n">labels</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="intake-all-scenes-using-the-intake-stac-library">
<h3>Intake all scenes using the intake-STAC library<a class="headerlink" href="#intake-all-scenes-using-the-intake-stac-library" title="Permalink to this headline">¶</a></h3>
<p>Intake-STAC facilitates discovering, exploring, and loading spatio-temporal datasets.</p>
<p>Intake-stac provides Intake Drivers for SpatioTemporal Asset Catalogs (STAC). It provides tools for opening STAC Catalogs, Collections, ItemCollections, and Items as Intake catalogs. By combining Intake and sat-stac, Intake-stac provides a simple toolkit for working with STAC catalogs and for loading STAC assets as Xarray objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_stac_item_collection</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br />
Let’s explore the metadata and keys for the first scene</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sceneid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">item0</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneid</span><span class="p">]</span>
<span class="n">item0</span><span class="o">.</span><span class="n">metadata</span>
<span class="c1"># for keys in item0.keys():</span>
<span class="c1">#     print (keys)</span>
</pre></div>
</div>
</div>
</div>
<p>We can explore the metadata for any of these:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item0</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the url needed to grab data from the S3 bucket</span>
<span class="c1"># Using the satsearch catalog:</span>
<span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asset</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="c1"># can use item asset name or title (blue or B2)</span>

<span class="c1"># Using the intake-STAC catalog</span>
<span class="n">item0</span><span class="o">.</span><span class="n">blue</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="c1"># must use item asset name (blue)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="should-i-keep-next-cell">
<h2>Should I keep next cell?<a class="headerlink" href="#should-i-keep-next-cell" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve first scene using rio</span>
<span class="n">item_url</span> <span class="o">=</span> <span class="n">item0</span><span class="o">.</span><span class="n">blue</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">]</span>

<span class="c1"># Read and plot with grid coordinates </span>
<span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">Env</span><span class="p">(</span><span class="n">aws_session</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">item_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="c1"># To plot</span>
        <span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># To open data into a numpy array</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="manipulating-data-in-xarray">
<h3>Manipulating data in Xarray<a class="headerlink" href="#manipulating-data-in-xarray" title="Permalink to this headline">¶</a></h3>
<p><strong>Tasha</strong></p>
<p>Poll:
*</p>
<p>Pandas and Xarray have very similar structures and ways of manipulating data, but Pandas excels with 2-D data and Xarray is ideal for more dimensions. Xarray introduces labels in the form of dimensions, coordinates and attributes on top of Pandas-like DataFrames.</p>
<p>Xarray doesn’t just keep track of labels on arrays – it uses them to provide a powerful and concise interface.</p>
<p>Read in 3 bands of a scene to xarray</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sceneid</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">sceneid</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">band_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span>

<span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Construct xarray for scene</span>
<span class="k">for</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">:</span>
    <span class="c1"># Specify chunk size (x,y), Landsat COG is in 512 chunks so can use this or a multiple</span>
    <span class="n">band</span> <span class="o">=</span> <span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">](</span><span class="n">chunks</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">512</span><span class="p">),</span><span class="n">urlpath</span><span class="o">=</span><span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span>
    <span class="n">band</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_name</span><span class="p">]</span>
    <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
<span class="n">scene</span>
</pre></div>
</div>
</div>
</div>
<p>Similarly as with pandas, you can explore variables easily. This time you can work with coordinates (equivalent to indices in pandas):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<p>Or keep track of arbitrary metadata (called attributes) in the form of a Python dictionary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<p>You can apply operations over dimensions by name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Mathematical operations (e.g., x - y) vectorize across multiple dimensions (array broadcasting) based on dimension names, not shape.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="c1">#.values</span>
</pre></div>
</div>
</div>
</div>
<p>Easily use the split-apply-combine paradigm with groupby:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;band&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Database-like alignment based on coordinate labels that smoothly handles missing values:</p>
<p>The N-dimensional nature of xarray’s data structures makes it suitable for dealing with multi-dimensional scientific data, and its use of dimension names instead of axis labels (dim=’time’ instead of axis=0) makes such arrays much more manageable than the raw numpy ndarray: with xarray, you don’t need to keep track of the order of an array’s dimensions or insert dummy dimensions of size 1 to align arrays (e.g., using np.newaxis).</p>
<p>The immediate payoff of using xarray is that you’ll write less code. The long-term payoff is that you’ll understand what you were thinking when you come back to look at it weeks or months later.</p>
<p><br />
Now let’s open all the bands and multiple days together into an xarray</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load dask, suppress warnings, each worker needs to run as requester pays</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                <span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">silence_logs</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AWS_REQUEST_PAYER&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;requester&quot;</span> <span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sceneids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
<span class="n">sceneids</span>
</pre></div>
</div>
</div>
</div>
<p><br />
Let’s create the time variable first for the xarray time dimension</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create time variable for time dim</span>
<span class="n">time_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">gf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">sceneid</span> <span class="k">for</span> <span class="n">sceneid</span> <span class="ow">in</span> <span class="n">sceneids</span> <span class="k">if</span> <span class="n">sceneid</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_T1&#39;</span><span class="p">)])][</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will search and collect band names for grabbing each desired band. We will just grab the bands that have 30 m pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Get band names</span>
<span class="n">sceneid</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sceneid</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sceneid</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span>
    <span class="k">if</span> <span class="s1">&#39;eo:bands&#39;</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
        <span class="n">resol</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="s1">&#39;eo:bands&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gsd&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resol</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span> 
            <span class="n">band_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            
<span class="c1"># Add qa band</span>
<span class="n">band_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;qa_pixel&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import to xarray</span>
<span class="c1"># In xarray dataframe nans are in locations where concat of multiple scenes has expanded the grid</span>

<span class="n">scenes</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">sceneid</span> <span class="ow">in</span> <span class="n">sceneids</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sceneid</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_T1&#39;</span><span class="p">):</span>
        <span class="n">sceneid</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">sceneid</span><span class="p">]</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">sceneid</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        
        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Construct xarray for scene</span>
        <span class="k">for</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">:</span>
            <span class="n">band</span> <span class="o">=</span> <span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">](</span><span class="n">chunks</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span><span class="n">urlpath</span><span class="o">=</span><span class="n">sceneid</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;href&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span> <span class="c1"># Specify chunk size, landsat is prob in 512 chunks so used multiple</span>
            <span class="n">band</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_name</span><span class="p">]</span>
            <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
        <span class="n">scenes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>

<span class="c1"># Concatenate scenes with time variable ***This is the slowest</span>
<span class="n">ls_scenes</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">scenes</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">time_var</span><span class="p">)</span>

<span class="n">pix</span> <span class="o">=</span> <span class="n">ls_scenes</span><span class="o">.</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">epsg</span> <span class="o">=</span> <span class="n">ls_scenes</span><span class="o">.</span><span class="n">crs</span>

<span class="n">ls_scenes</span>
</pre></div>
</div>
</div>
</div>
<p>We now have 2 Landsat scenes with all of the bands we are interested in stored in an xarray.</p>
<p>We can also easily subset and visualize:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sbands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;nir08&#39;</span><span class="p">,</span> <span class="s1">&#39;swir16&#39;</span><span class="p">,</span><span class="s1">&#39;cirrus&#39;</span><span class="p">,</span> <span class="s1">&#39;lwir11&#39;</span><span class="p">]</span>
<span class="n">sub_box</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># for t in thw.time.values:</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ls_scene</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Further subset to polynya location if desired </span>
<span class="n">pulx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1590700</span>
<span class="n">puly</span> <span class="o">=</span> <span class="o">-</span><span class="mi">428200</span>
<span class="n">plrx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1584000</span>
<span class="n">plry</span> <span class="o">=</span> <span class="o">-</span><span class="mi">433600</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">ls_scene</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">band</span><span class="o">=</span><span class="n">sbands</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">plry</span><span class="p">,</span><span class="n">puly</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">pulx</span><span class="p">,</span><span class="n">plrx</span><span class="p">))</span>

<span class="c1"># For use at the end for coordinates</span>
<span class="n">pol_y</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">y</span>
<span class="n">pol_x</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">x</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span><span class="mi">0</span><span class="p">))</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">n_band</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;Subset window&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">thw</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>You have seen how we can search for non-ICESat_2 datasets, open them into pandas and xarray dataframes, and manipulate/explore the dataframes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have noticed Jupyter Book adds some extra formatting features that do not necessarily render as you might expect when <em>executing</em> a noteook in Jupyter Lab. This “admonition” note is one such example.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Jupyter Book is very particular about <a class="reference external" href="https://jupyterbook.org/structure/sections-headers.html?highlight=headers#how-headers-and-sections-map-onto-to-book-structure">Markdown header ordering</a> to automatically create table of contents on the website. In this tutorial we are careful to use a single main header (#) and sequential subheaders (#, ##, ###, etc.)</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>To further explore the topics of this tutorial see the following detailed documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jupyterbook.org/file-types/notebooks.html">Jupyter Book rendering of .ipynb notebooks</a></p></li>
<li><p><a class="reference external" href="https://jupyterbook.org/content/index.html">Jupyter Book guide on writing narrative content</a></p></li>
<li><p><a class="reference external" href="https://ipyleaflet.readthedocs.io">ipyleaflet documentation</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/DataIntegration"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../geospatial/geospatial-advanced.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Geospatial Transformations In-depth</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../DataVisualization/Visualization_Earth_Engine_geemap_IS2_HW_2022.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interactive Visualizion with Open Altimetry &amp; Google Earth Engine</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By eScience Institute, University of Washington<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>